# è¨‚å–®è¿½è¹¤ç³»çµ±æ”¹é€ éœ€æ±‚æ–‡æª”

## ğŸ“‹ ç›®éŒ„
1. [ç•¶å‰ç³»çµ±æ¶æ§‹åˆ†æ](#ç•¶å‰ç³»çµ±æ¶æ§‹åˆ†æ)
2. [æ ¸å¿ƒæ”¹é€ éœ€æ±‚](#æ ¸å¿ƒæ”¹é€ éœ€æ±‚)
3. [æ•¸æ“šçµæ§‹èª¿æ•´](#æ•¸æ“šçµæ§‹èª¿æ•´)
4. [åŠŸèƒ½å¯¦ç¾æ¸…å–®](#åŠŸèƒ½å¯¦ç¾æ¸…å–®)
5. [AI å¯¦ç¾æŒ‡å¼•](#ai-å¯¦ç¾æŒ‡å¼•)

---

## ç•¶å‰ç³»çµ±æ¶æ§‹åˆ†æ

### ç¾æœ‰æ¶æ§‹
- **è¨‚å–®æ¨¡å‹**ï¼š`models.py` ä¸­å®šç¾©äº† `Order` æ¨¡å‹
- **ç‹€æ…‹ç®¡ç†**ï¼šæœ‰å®Œæ•´çš„ç‹€æ…‹æµè½‰ç³»çµ±
- **ç”¨æˆ¶è§’è‰²**ï¼šæœ‰ `admin` å’Œ `viewer` è§’è‰²
- **å‰ç«¯ç•Œé¢**ï¼šè¨‚å–®åˆ—è¡¨ã€è¨‚å–®è©³æƒ…é 

### ç¼ºå°‘çš„æ ¸å¿ƒåŠŸèƒ½
1. âŒ ç”¢å“/æµç¨‹ç®¡ç†ï¼ˆä¸€å¼µè¨‚å–®ä¸‹çš„å¤šå€‹ç”¢å“ï¼‰
2. âŒ æª”æ¡ˆä¸Šå‚³èˆ‡ç®¡ç†ç³»çµ±
3. âŒ æ¥­å‹™å“¡èˆ‡ä¸»ç®¡è§’è‰²å€åˆ†
4. âŒ æ¬Šé™æ§åˆ¶ç³»çµ±
5. âŒ ç”¢å“è½‰ç§»åŠŸèƒ½
6. âŒ ä¸»ç®¡å°ˆç”¨åŠŸèƒ½ï¼ˆç”¨æˆ¶ç®¡ç†ã€ç”¢å“è½‰ç§»ã€å„€è¡¨æ¿ï¼‰
7. âŒ å³å´æŠ½å±œèˆ‡åœ–ç‰‡ç®¡ç† UI

---

## æ ¸å¿ƒæ”¹é€ éœ€æ±‚

### æ¥­å‹™é‚è¼¯èª¿æ•´

#### 1. è¨‚å–®å‰µå»ºæ¬Šé™èª¿æ•´
```
ç•¶å‰ï¼šæ¥­å‹™å“¡å¯ä»¥å‰µå»ºè¨‚å–®ï¼ˆorder_number å¯ä»¥æ˜¯ YU é–‹é ­æˆ–è‡ªå®šç¾©ï¼‰
æ”¹ç‚ºï¼š
  - ä¸»ç®¡å‰µå»ºè¨‚å–®ï¼ˆè¨‚å–®è™Ÿç”±ä¸»ç®¡æ±ºå®šï¼Œå›ºå®šä¸å¯æ”¹ï¼‰
  - æ¥­å‹™å“¡åªèƒ½åœ¨è¨‚å–®ä¸‹å‰µå»ºç”¢å“/æµç¨‹
  - æ¥­å‹™å“¡ä¸èƒ½å‰µå»ºè¨‚å–®
```

#### 2. æ–°çš„å±¤ç´šçµæ§‹
```
è¨‚å–®ï¼ˆOrderï¼‰
  â”œâ”€â”€ è¨‚å–®è™Ÿï¼šKC0001ï¼ˆä¸»ç®¡å‰µå»ºï¼Œå›ºå®šä¸è®Šï¼‰
  â”œâ”€â”€ å®¢æˆ¶ï¼šABC å…¬å¸
  â””â”€â”€ ç”¢å“åˆ—è¡¨ï¼ˆProductsï¼‰
       â”œâ”€â”€ ç”¢å“1ï¼šç´…è‰²æ¯å­ï¼ˆæ¥­å‹™å“¡ç‹å°æ˜å‰µå»ºï¼‰
       â”‚   â”œâ”€â”€ ç”¢å“ç·¨è™Ÿï¼šPR001
       â”‚   â”œâ”€â”€ è² è²¬äººï¼šç‹å°æ˜
       â”‚   â”œâ”€â”€ ç‹€æ…‹ï¼šåœ–ç¨¿ç¢ºèªä¸­
       â”‚   â””â”€â”€ æª”æ¡ˆè³‡æ–™å¤¾ï¼š/uploads/KC0001/PR001/
       â”‚
       â”œâ”€â”€ ç”¢å“2ï¼šè—è‰²ç›¤å­ï¼ˆæ¥­å‹™å“¡ç‹å°æ˜å‰µå»ºï¼‰
       â”‚   â”œâ”€â”€ ç”¢å“ç·¨è™Ÿï¼šPR002
       â”‚   â”œâ”€â”€ è² è²¬äººï¼šç‹å°æ˜
       â”‚   â””â”€â”€ æª”æ¡ˆè³‡æ–™å¤¾ï¼š/uploads/KC0001/PR002/
       â”‚
       â””â”€â”€ ç”¢å“3ï¼šç¶ è‰²ç¢—ï¼ˆæ¥­å‹™å“¡å¼µå°è¯å‰µå»ºï¼‰
           â”œâ”€â”€ ç”¢å“ç·¨è™Ÿï¼šPR003
           â”œâ”€â”€ è² è²¬äººï¼šå¼µå°è¯
           â””â”€â”€ æª”æ¡ˆè³‡æ–™å¤¾ï¼š/uploads/KC0001/PR003/
```

---

## æ•¸æ“šçµæ§‹èª¿æ•´

### 1. ç”¨æˆ¶è¡¨ï¼ˆusersï¼‰- éœ€è¦æ“´å……

```python
# ç•¶å‰å¯èƒ½åªæœ‰åŸºæœ¬çš„ç”¨æˆ¶èªè­‰
# éœ€è¦æ·»åŠ ï¼š

class User:
    id                  # ç”¨æˆ¶ID
    username            # ç”¨æˆ¶å
    password_hash       # å¯†ç¢¼ï¼ˆåŠ å¯†ï¼‰
    real_name           # çœŸå¯¦å§“åï¼ˆä¾‹å¦‚ï¼šç‹å°æ˜ï¼‰
    role                # è§’è‰²ï¼š'admin'ï¼ˆä¸»ç®¡ï¼‰æˆ– 'staff'ï¼ˆæ¥­å‹™å“¡ï¼‰
    created_at          # å‰µå»ºæ™‚é–“
    is_active           # æ˜¯å¦å•Ÿç”¨
```

### 2. è¨‚å–®è¡¨ï¼ˆordersï¼‰- éœ€è¦èª¿æ•´

```python
class Order:
    # ä¿ç•™ç¾æœ‰æ¬„ä½ï¼š
    order_number        # è¨‚å–®è™Ÿï¼ˆä¸å¯æ”¹ï¼‰
    customer_name       # å®¢æˆ¶åç¨±
    order_date          # è¨‚å–®æ—¥æœŸ
    created_at          # å‰µå»ºæ™‚é–“
    
    # æ–°å¢æ¬„ä½ï¼š
    created_by_id       # å‰µå»ºè€…IDï¼ˆé—œè¯ Userï¼Œä¸»ç®¡ï¼‰
    
    # ç§»é™¤æˆ–èª¿æ•´ï¼š
    # current_status    # ä¸å†åœ¨è¨‚å–®å±¤ç´šï¼Œç§»åˆ°ç”¢å“å±¤ç´š
    # product_code      # ä¸å†åœ¨è¨‚å–®å±¤ç´šï¼Œç§»åˆ°ç”¢å“å±¤ç´š
    # quantity          # ä¸å†åœ¨è¨‚å–®å±¤ç´šï¼Œç§»åˆ°ç”¢å“å±¤ç´š
    # factory           # ä¸å†åœ¨è¨‚å–®å±¤ç´šï¼Œç§»åˆ°ç”¢å“å±¤ç´š
    # production_type   # ä¸å†åœ¨è¨‚å–®å±¤ç´šï¼Œç§»åˆ°ç”¢å“å±¤ç´š
```

### 3. ç”¢å“è¡¨ï¼ˆproductsï¼‰- **æ–°å¢**

```python
class Product:
    id                      # ç”¢å“IDï¼ˆè‡ªå‹•ç”Ÿæˆï¼Œä¾‹å¦‚ï¼šPR001ï¼‰
    order_number            # æ‰€å±¬è¨‚å–®è™Ÿï¼ˆé—œè¯ Orderï¼‰
    product_code            # ç”¢å“ç·¨è™Ÿï¼ˆä¾‹å¦‚ï¼šP-RED-CUPï¼‰
    product_name            # ç”¢å“åç¨±ï¼ˆä¾‹å¦‚ï¼šç´…è‰²æ¯å­ï¼‰
    quantity                # æ•¸é‡
    factory                 # ç”Ÿç”¢å·¥å» 
    production_type         # ç”Ÿç”¢é¡å‹
    expected_delivery_date  # é è¨ˆäº¤è²¨æ—¥æœŸ
    
    # ç‹€æ…‹ç®¡ç†
    current_status          # ç•¶å‰ç‹€æ…‹ï¼ˆå¾è¨‚å–®è¡¨ç§»éä¾†ï¼‰
    status_updated_at       # ç‹€æ…‹æ›´æ–°æ™‚é–“
    status_days             # åœ¨ç•¶å‰ç‹€æ…‹åœç•™å¤©æ•¸
    
    # äººå“¡ç®¡ç†
    created_by_id           # å‰µå»ºè€…IDï¼ˆé—œè¯ Userï¼Œèª°å‰µå»ºçš„ç”¢å“ï¼‰
    handler_id              # ç•¶å‰è² è²¬äººIDï¼ˆé—œè¯ Userï¼Œèª°è² è²¬é€™å€‹ç”¢å“ï¼‰
    
    # è³‡æ–™å¤¾è·¯å¾‘
    folder_path             # æª”æ¡ˆè³‡æ–™å¤¾è·¯å¾‘ï¼ˆä¾‹å¦‚ï¼š/uploads/KC0001/PR001/ï¼‰
    
    # æ™‚é–“æˆ³
    created_at              # å‰µå»ºæ™‚é–“
    updated_at              # æ›´æ–°æ™‚é–“
    
    # å‚™è¨»
    notes                   # ç”¢å“å‚™è¨»
```

### 4. æª”æ¡ˆè¡¨ï¼ˆfilesï¼‰- **æ–°å¢**

```python
class File:
    id                  # æª”æ¡ˆIDï¼ˆè‡ªå‹•ç”Ÿæˆï¼Œä¾‹å¦‚ï¼šF00001ï¼‰
    order_number        # æ‰€å±¬è¨‚å–®è™Ÿï¼ˆé—œè¯ Orderï¼‰
    product_id          # æ‰€å±¬ç”¢å“IDï¼ˆé—œè¯ Productï¼‰
    
    # æª”æ¡ˆä¿¡æ¯
    filename            # åŸå§‹æª”åï¼ˆä¾‹å¦‚ï¼šdrawing_v1.jpgï¼‰
    file_path           # å¯¦éš›å­˜å„²è·¯å¾‘ï¼ˆä¾‹å¦‚ï¼š/uploads/KC0001/PR001/drawing_v1.jpgï¼‰
    file_size           # æª”æ¡ˆå¤§å°ï¼ˆbytesï¼‰
    file_type           # æª”æ¡ˆé¡å‹ï¼ˆimage/jpeg, application/pdf ç­‰ï¼‰
    
    # ä¸Šå‚³ä¿¡æ¯
    uploaded_by_id      # ä¸Šå‚³è€…IDï¼ˆé—œè¯ Userï¼‰
    uploaded_at         # ä¸Šå‚³æ™‚é–“
    
    # åˆªé™¤æ¨™è¨˜ï¼ˆè»Ÿåˆªé™¤ï¼‰
    is_deleted          # æ˜¯å¦å·²åˆªé™¤ï¼ˆtrue/falseï¼‰
    deleted_by_id       # åˆªé™¤è€…IDï¼ˆé—œè¯ Userï¼Œå¯ç‚ºç©ºï¼‰
    deleted_at          # åˆªé™¤æ™‚é–“ï¼ˆå¯ç‚ºç©ºï¼‰
```

### 5. ç”¢å“ç‹€æ…‹æ­·å²è¡¨ï¼ˆproduct_status_historyï¼‰- **æ–°å¢**

```python
class ProductStatusHistory:
    id                  # è¨˜éŒ„ID
    product_id          # ç”¢å“IDï¼ˆé—œè¯ Productï¼‰
    order_number        # è¨‚å–®è™Ÿï¼ˆå†—é¤˜ï¼Œæ–¹ä¾¿æŸ¥è©¢ï¼‰
    
    from_status         # åŸç‹€æ…‹
    to_status           # æ–°ç‹€æ…‹
    action_date         # æ“ä½œæ—¥æœŸ
    
    operator_id         # æ“ä½œè€…IDï¼ˆé—œè¯ Userï¼‰
    notes               # å‚™è¨»
    
    created_at          # è¨˜éŒ„å‰µå»ºæ™‚é–“
```

### 6. ç”¢å“è½‰ç§»è¨˜éŒ„è¡¨ï¼ˆproduct_handover_logï¼‰- **æ–°å¢**ï¼ˆå¯é¸ï¼‰

```python
class ProductHandoverLog:
    id                  # è¨˜éŒ„ID
    product_id          # ç”¢å“IDï¼ˆé—œè¯ Productï¼‰
    order_number        # è¨‚å–®è™Ÿï¼ˆå†—é¤˜ï¼‰
    
    from_handler_id     # åŸè² è²¬äººIDï¼ˆé—œè¯ Userï¼‰
    to_handler_id       # æ–°è² è²¬äººIDï¼ˆé—œè¯ Userï¼‰
    handover_by_id      # åŸ·è¡Œè½‰ç§»çš„ä¸»ç®¡IDï¼ˆé—œè¯ Userï¼‰
    
    handover_date       # è½‰ç§»æ—¥æœŸ
    reason              # è½‰ç§»åŸå› ï¼ˆå¯é¸ï¼‰
    
    created_at          # è¨˜éŒ„å‰µå»ºæ™‚é–“
```

### 7. é€šçŸ¥è¡¨ï¼ˆnotificationsï¼‰- **æ–°å¢**

```python
class Notification:
    id                  # é€šçŸ¥ID
    user_id             # æ¥æ”¶é€šçŸ¥çš„ç”¨æˆ¶IDï¼ˆé—œè¯ Userï¼‰
    
    # é€šçŸ¥å…§å®¹
    type                # é€šçŸ¥é¡å‹ï¼ˆorder_created, product_transferred, overdue_alert ç­‰ï¼‰
    title               # é€šçŸ¥æ¨™é¡Œï¼ˆä¾‹å¦‚ï¼šæ–°è¨‚å–®å‰µå»ºï¼‰
    message             # é€šçŸ¥å…§å®¹ï¼ˆä¾‹å¦‚ï¼šæç¶“ç†å‰µå»ºäº†è¨‚å–® #KC0051ï¼‰
    
    # é—œè¯æ•¸æ“š
    order_number        # ç›¸é—œè¨‚å–®è™Ÿï¼ˆå¯ç‚ºç©ºï¼‰
    product_id          # ç›¸é—œç”¢å“IDï¼ˆå¯ç‚ºç©ºï¼‰
    
    # ç‹€æ…‹
    is_read             # æ˜¯å¦å·²è®€ï¼ˆtrue/falseï¼‰
    read_at             # è®€å–æ™‚é–“ï¼ˆå¯ç‚ºç©ºï¼‰
    
    # æ™‚é–“æˆ³
    created_at          # å‰µå»ºæ™‚é–“
```

### 8. æ“ä½œæ—¥èªŒè¡¨ï¼ˆoperation_logsï¼‰- **æ–°å¢**

```python
class OperationLog:
    id                  # æ—¥èªŒID
    user_id             # æ“ä½œè€…IDï¼ˆé—œè¯ Userï¼‰
    
    # æ“ä½œä¿¡æ¯
    operation_type      # æ“ä½œé¡å‹ï¼ˆcreate_order, create_product, transfer_product, modify_user ç­‰ï¼‰
    operation_desc      # æ“ä½œæè¿°ï¼ˆä¾‹å¦‚ï¼šå‰µå»ºè¨‚å–® #KC0051ï¼‰
    
    # é—œè¯æ•¸æ“š
    order_number        # ç›¸é—œè¨‚å–®è™Ÿï¼ˆå¯ç‚ºç©ºï¼‰
    product_id          # ç›¸é—œç”¢å“IDï¼ˆå¯ç‚ºç©ºï¼‰
    target_user_id      # ç›®æ¨™ç”¨æˆ¶IDï¼ˆä¾‹å¦‚è½‰ç§»çµ¦èª°ï¼Œå¯ç‚ºç©ºï¼‰
    
    # è©³ç´°æ•¸æ“šï¼ˆJSONï¼‰
    details             # è©³ç´°æ•¸æ“šï¼ˆJSONæ ¼å¼ï¼Œè¨˜éŒ„æ“ä½œå‰å¾Œçš„å€¼ï¼‰
    
    # IP å’Œè¨­å‚™ä¿¡æ¯ï¼ˆå¯é¸ï¼‰
    ip_address          # æ“ä½œè€…IPåœ°å€
    user_agent          # ç€è¦½å™¨ä¿¡æ¯
    
    # æ™‚é–“æˆ³
    created_at          # æ“ä½œæ™‚é–“
```

---

## åŠŸèƒ½å¯¦ç¾æ¸…å–®

### éšæ®µä¸€ï¼šåŸºç¤æ•¸æ“šçµæ§‹èˆ‡æ¬Šé™ç³»çµ±

#### 1.1 æ•¸æ“šåº«é·ç§»
```
ä»»å‹™ï¼šå‰µå»ºæ–°çš„æ•¸æ“šè¡¨å’Œèª¿æ•´ç¾æœ‰æ•¸æ“šè¡¨

éœ€è¦å‰µå»ºï¼š
- [ ] products è¡¨
- [ ] files è¡¨
- [ ] product_status_history è¡¨
- [ ] product_handover_log è¡¨ï¼ˆå¯é¸ï¼‰

éœ€è¦èª¿æ•´ï¼š
- [ ] users è¡¨ï¼ˆæ·»åŠ  real_name, role æ¬„ä½ï¼‰
- [ ] orders è¡¨ï¼ˆæ·»åŠ  created_by_idï¼Œç§»é™¤ç”¢å“ç›¸é—œæ¬„ä½ï¼‰
- [ ] å°‡ç¾æœ‰ order_status_history æ”¹ç‚º product_status_history

é·ç§»è…³æœ¬éœ€è¦ï¼š
- [ ] å°‡ç¾æœ‰è¨‚å–®æ•¸æ“šé·ç§»åˆ°æ–°çµæ§‹ï¼ˆæ¯å€‹è¨‚å–®å‰µå»ºä¸€å€‹é»˜èªç”¢å“ï¼‰
- [ ] ä¿ç•™ç¾æœ‰ç‹€æ…‹æ­·å²
```

#### 1.2 ç”¨æˆ¶èªè­‰èˆ‡è§’è‰²ç³»çµ±
```
éœ€è¦å¯¦ç¾ï¼š
- [ ] æ“´å……ç”¨æˆ¶æ¨¡å‹ï¼ˆæ·»åŠ  real_name, roleï¼‰
- [ ] ç™»å…¥æ™‚è­˜åˆ¥ç”¨æˆ¶è§’è‰²ï¼ˆadmin / staffï¼‰
- [ ] Session ä¸­å­˜å„²ç”¨æˆ¶ ID å’Œè§’è‰²
- [ ] å‰µå»ºæ¬Šé™æª¢æŸ¥è£é£¾å™¨ï¼ˆ@admin_required, @login_requiredï¼‰
```

### éšæ®µäºŒï¼šç”¢å“ç®¡ç†åŠŸèƒ½

#### 2.1 ä¸»ç®¡å‰µå»ºè¨‚å–®
```
åŠŸèƒ½ï¼šä¸»ç®¡å¯ä»¥å‰µå»ºæ–°è¨‚å–®

API ç«¯é»ï¼š
- POST /tracking/api/orders
  
æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "order_number": "KC0001",      // ä¸»ç®¡æŒ‡å®šï¼Œå¿…å¡«
  "customer_name": "ABCå…¬å¸",    // å¿…å¡«
  "order_date": "2026-01-15"     // å¿…å¡«
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "order_number": "KC0001",
    "customer_name": "ABCå…¬å¸",
    "created_by": "æç¶“ç†"
  }
}

é‚è¼¯ï¼š
1. æª¢æŸ¥ç”¨æˆ¶è§’è‰²ï¼ˆå¿…é ˆæ˜¯ adminï¼‰
2. æª¢æŸ¥è¨‚å–®è™Ÿæ˜¯å¦å·²å­˜åœ¨
3. å‰µå»ºè¨‚å–®è¨˜éŒ„
4. ä¸å‰µå»ºè³‡æ–™å¤¾ï¼ˆç­‰ç”¢å“å‰µå»ºæ™‚æ‰å‰µå»ºï¼‰
```

#### 2.2 æ¥­å‹™å“¡å‰µå»ºç”¢å“
```
åŠŸèƒ½ï¼šæ¥­å‹™å“¡åœ¨è¨‚å–®ä¸‹å‰µå»ºç”¢å“/æµç¨‹

API ç«¯é»ï¼š
- POST /tracking/api/orders/{order_number}/products

æ¬Šé™ï¼šç™»å…¥ç”¨æˆ¶ï¼ˆadmin æˆ– staffï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "product_name": "ç´…è‰²æ¯å­",
  "product_code": "P-RED-CUP",
  "quantity": 500,
  "factory": "Aå·¥å» ",
  "production_type": "æ–°å“",
  "expected_delivery_date": "2026-03-15",
  "notes": "å‚™è¨»"
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "product_id": "PR001",
    "order_number": "KC0001",
    "product_name": "ç´…è‰²æ¯å­",
    "handler": "ç‹å°æ˜",
    "folder_path": "/uploads/KC0001/PR001/"
  }
}

é‚è¼¯ï¼š
1. æª¢æŸ¥è¨‚å–®æ˜¯å¦å­˜åœ¨
2. ç”Ÿæˆç”¢å“IDï¼ˆPR001, PR002...ï¼‰
3. å‰µå»ºç”¢å“è¨˜éŒ„ï¼ˆhandler_id = ç•¶å‰ç”¨æˆ¶IDï¼‰
4. å‰µå»ºè³‡æ–™å¤¾ï¼ˆ/uploads/è¨‚å–®è™Ÿ/ç”¢å“ID/ï¼‰
5. åˆå§‹åŒ–ç”¢å“ç‹€æ…‹ç‚ºã€Œæ–°è¨‚å–®ã€
6. è¨˜éŒ„ç‹€æ…‹æ­·å²
```

#### 2.3 æŸ¥è©¢ç”¢å“åˆ—è¡¨
```
åŠŸèƒ½ï¼šæ ¹æ“šè§’è‰²æŸ¥çœ‹ç”¢å“åˆ—è¡¨

API ç«¯é»ï¼š
- GET /tracking/api/orders/{order_number}/products

æ¬Šé™é‚è¼¯ï¼š
- ä¸»ç®¡ï¼ˆadminï¼‰ï¼šçœ‹æ‰€æœ‰ç”¢å“
- æ¥­å‹™å“¡ï¼ˆstaffï¼‰ï¼šåªçœ‹è‡ªå·±è² è²¬çš„ç”¢å“ï¼ˆhandler_id = ç•¶å‰ç”¨æˆ¶IDï¼‰

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": [
    {
      "product_id": "PR001",
      "product_name": "ç´…è‰²æ¯å­",
      "current_status": "åœ–ç¨¿ç¢ºèªä¸­",
      "handler": "ç‹å°æ˜",
      "created_by": "ç‹å°æ˜",
      "status_days": 3,
      "file_count": 5
    }
  ]
}
```

#### 2.4 ç”¢å“è½‰ç§»ï¼ˆä¸»ç®¡å°ˆç”¨ï¼‰
```
åŠŸèƒ½ï¼šä¸»ç®¡å¯ä»¥æŠŠç”¢å“è½‰çµ¦å…¶ä»–æ¥­å‹™å“¡

API ç«¯é»ï¼š
- POST /tracking/api/products/{product_id}/transfer

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "new_handler_id": "USER123",   // æ–°è² è²¬äººçš„ç”¨æˆ¶ID
  "reason": "ç‹å°æ˜è«‹å‡"          // å¯é¸
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "message": "ç”¢å“å·²è½‰ç§»çµ¦å¼µå°è¯"
}

é‚è¼¯ï¼š
1. æª¢æŸ¥ç”¨æˆ¶è§’è‰²ï¼ˆå¿…é ˆæ˜¯ adminï¼‰
2. æª¢æŸ¥ç”¢å“æ˜¯å¦å­˜åœ¨
3. æª¢æŸ¥æ–°è² è²¬äººæ˜¯å¦å­˜åœ¨
4. æ›´æ–°ç”¢å“çš„ handler_id
5. è¨˜éŒ„è½‰ç§»æ­·å²ï¼ˆproduct_handover_log è¡¨ï¼‰
6. æª”æ¡ˆè³‡æ–™å¤¾ä¸å‹•
7. æ­·å²è¨˜éŒ„ä¿ç•™åŸæ“ä½œäºº
```

### éšæ®µä¸‰ï¼šæª”æ¡ˆä¸Šå‚³èˆ‡ç®¡ç†

#### 3.1 æª”æ¡ˆä¸Šå‚³
```
åŠŸèƒ½ï¼šæ¥­å‹™å“¡ä¸Šå‚³æª”æ¡ˆåˆ°è‡ªå·±è² è²¬çš„ç”¢å“

API ç«¯é»ï¼š
- POST /tracking/api/products/{product_id}/files

æ¬Šé™é‚è¼¯ï¼š
1. æª¢æŸ¥ç”¢å“æ˜¯å¦å­˜åœ¨
2. æª¢æŸ¥ç”¢å“çš„ handler_id æ˜¯å¦ç­‰æ–¼ç•¶å‰ç”¨æˆ¶ID
3. ä¸»ç®¡å¯ä»¥ä¸Šå‚³åˆ°ä»»ä½•ç”¢å“

è«‹æ±‚ï¼š
- è¡¨å–®æ•¸æ“šï¼ˆmultipart/form-dataï¼‰
- file: æª”æ¡ˆå°è±¡

é‚è¼¯ï¼š
1. é©—è­‰æ¬Šé™
2. æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆ< 10MBï¼‰
3. æª¢æŸ¥æª”æ¡ˆé¡å‹ï¼ˆåœ–ç‰‡ã€PDFã€Excel ç­‰ï¼‰
4. ç”Ÿæˆæª”æ¡ˆIDï¼ˆF00001, F00002...ï¼‰
5. ä¿å­˜æª”æ¡ˆåˆ°ï¼š/uploads/è¨‚å–®è™Ÿ/ç”¢å“ID/åŸå§‹æª”å
6. è¨˜éŒ„åˆ° files è¡¨ï¼š
   - product_id
   - order_number
   - file_path
   - uploaded_by_id = ç•¶å‰ç”¨æˆ¶ID
7. è¿”å›æª”æ¡ˆä¿¡æ¯

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "file_id": "F00001",
    "filename": "drawing_v1.jpg",
    "file_size": 1024000,
    "uploaded_by": "ç‹å°æ˜",
    "uploaded_at": "2026-01-15 10:30:00"
  }
}
```

#### 3.2 æª”æ¡ˆåˆ—è¡¨æŸ¥è©¢
```
åŠŸèƒ½ï¼šæŸ¥çœ‹ç”¢å“ä¸‹çš„æ‰€æœ‰æª”æ¡ˆ

API ç«¯é»ï¼š
- GET /tracking/api/products/{product_id}/files

æ¬Šé™é‚è¼¯ï¼š
- æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰æ¬Šé™çœ‹é€™å€‹ç”¢å“ï¼ˆhandler æˆ– adminï¼‰

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": [
    {
      "file_id": "F00001",
      "filename": "drawing_v1.jpg",
      "file_size": 1024000,
      "uploaded_by": "ç‹å°æ˜",
      "uploaded_by_id": "USER001",
      "uploaded_at": "2026-01-15 10:30:00",
      "can_delete": true    // æ˜¯å¦å¯ä»¥åˆªé™¤ï¼ˆè‡ªå·±ä¸Šå‚³çš„æˆ–ä¸»ç®¡ï¼‰
    },
    {
      "file_id": "F00002",
      "filename": "quotation.pdf",
      "file_size": 512000,
      "uploaded_by": "å¼µå°è¯",
      "uploaded_by_id": "USER002",
      "uploaded_at": "2026-01-16 14:20:00",
      "can_delete": false   // ä¸æ˜¯è‡ªå·±ä¸Šå‚³çš„ï¼Œä¸èƒ½åˆª
    }
  ]
}
```

#### 3.3 æª”æ¡ˆä¸‹è¼‰
```
åŠŸèƒ½ï¼šä¸‹è¼‰æª”æ¡ˆ

API ç«¯é»ï¼š
- GET /tracking/api/files/{file_id}/download

æ¬Šé™é‚è¼¯ï¼š
1. æŸ¥è©¢æª”æ¡ˆè¨˜éŒ„ï¼ˆå¾ files è¡¨ï¼‰
2. æ‰¾åˆ°æª”æ¡ˆæ‰€å±¬çš„ product_id
3. æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰æ¬Šé™çœ‹é€™å€‹ç”¢å“
4. ä¸»ç®¡å¯ä»¥ä¸‹è¼‰ä»»ä½•æª”æ¡ˆ

é‚è¼¯ï¼š
1. é©—è­‰æ¬Šé™
2. è®€å–æª”æ¡ˆï¼ˆå¾ file_pathï¼‰
3. è¨­ç½®æ­£ç¢ºçš„ Content-Type
4. è¨­ç½® Content-Dispositionï¼ˆè®“ç€è¦½å™¨ä¸‹è¼‰ï¼‰
5. è¿”å›æª”æ¡ˆæµ

å¯é¸ï¼šè¨˜éŒ„ä¸‹è¼‰æ­·å²
```

#### 3.4 æª”æ¡ˆåˆªé™¤
```
åŠŸèƒ½ï¼šåˆªé™¤æª”æ¡ˆï¼ˆåƒ…è‡ªå·±ä¸Šå‚³çš„ï¼‰

API ç«¯é»ï¼š
- DELETE /tracking/api/files/{file_id}

æ¬Šé™é‚è¼¯ï¼š
1. æŸ¥è©¢æª”æ¡ˆè¨˜éŒ„
2. æª¢æŸ¥ç”¢å“çš„ handler_id æ˜¯å¦ç­‰æ–¼ç•¶å‰ç”¨æˆ¶ID
3. æª¢æŸ¥æª”æ¡ˆçš„ uploaded_by_id æ˜¯å¦ç­‰æ–¼ç•¶å‰ç”¨æˆ¶ID
4. ä¸»ç®¡å¯ä»¥åˆªé™¤ä»»ä½•æª”æ¡ˆ

é‚è¼¯ï¼ˆè»Ÿåˆªé™¤ï¼‰ï¼š
1. é©—è­‰æ¬Šé™
2. æ›´æ–° files è¡¨ï¼š
   - is_deleted = true
   - deleted_by_id = ç•¶å‰ç”¨æˆ¶ID
   - deleted_at = ç•¶å‰æ™‚é–“
3. ä¸å¯¦éš›åˆªé™¤æª”æ¡ˆï¼ˆä¿ç•™åœ¨ç¡¬ç¢Ÿï¼‰

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "message": "æª”æ¡ˆå·²åˆªé™¤"
}
```

### éšæ®µä¸‰ä¹‹äºŒï¼šä¸»ç®¡å°ˆç”¨åŠŸèƒ½

#### 3.2.1 ç”¨æˆ¶å¸³è™Ÿç®¡ç†

##### åŠŸèƒ½æ¦‚è¿°
ä¸»ç®¡éœ€è¦èƒ½å¤ å‰µå»ºã€ç·¨è¼¯ã€åœç”¨æ¥­å‹™å“¡å¸³è™Ÿï¼Œç®¡ç†å¯†ç¢¼ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶åˆ—è¡¨ã€‚

##### 3.2.1.1 ç”¨æˆ¶åˆ—è¡¨é é¢

```
é é¢è·¯å¾‘ï¼š/admin/users

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

ç•Œé¢è¨­è¨ˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ¶ç®¡ç†                          [+ æ–°å¢ç”¨æˆ¶] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æœå°‹ç”¨æˆ¶...]                     [ç¯©é¸â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ ç‹å°æ˜ (staff)                    â”‚ â”‚
â”‚ â”‚ wangxiaoming Â· staff Â· å•Ÿç”¨ä¸­        â”‚ â”‚
â”‚ â”‚ å‰µå»ºæ™‚é–“ï¼š2025-01-10                 â”‚ â”‚
â”‚ â”‚ è² è²¬ç”¢å“ï¼š15 å€‹                      â”‚ â”‚
â”‚ â”‚ [ç·¨è¼¯] [é‡è¨­å¯†ç¢¼] [åœç”¨]             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ å¼µå°è¯ (staff)                    â”‚ â”‚
â”‚ â”‚ zhangxiaohua Â· staff Â· å•Ÿç”¨ä¸­        â”‚ â”‚
â”‚ â”‚ å‰µå»ºæ™‚é–“ï¼š2025-01-12                 â”‚ â”‚
â”‚ â”‚ è² è²¬ç”¢å“ï¼š8 å€‹                       â”‚ â”‚
â”‚ â”‚ [ç·¨è¼¯] [é‡è¨­å¯†ç¢¼] [åœç”¨]             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ æç¶“ç† (admin)                    â”‚ â”‚
â”‚ â”‚ lijingli Â· admin Â· å•Ÿç”¨ä¸­            â”‚ â”‚
â”‚ â”‚ å‰µå»ºæ™‚é–“ï¼š2024-12-01                 â”‚ â”‚
â”‚ â”‚ [ç·¨è¼¯]                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 3.2.1.2 æ–°å¢ç”¨æˆ¶ API

```javascript
// å‰µå»ºæ–°ç”¨æˆ¶
POST /api/admin/users

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "username": "wangxiaoming",      // ç™»å…¥å¸³è™Ÿï¼ˆå”¯ä¸€ï¼‰
  "password": "initial123",        // åˆå§‹å¯†ç¢¼
  "real_name": "ç‹å°æ˜",           // çœŸå¯¦å§“å
  "role": "staff"                  // è§’è‰²ï¼šadmin æˆ– staff
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "user_id": "USER003",
    "username": "wangxiaoming",
    "real_name": "ç‹å°æ˜",
    "role": "staff",
    "is_active": true,
    "created_at": "2026-01-16 10:30:00"
  }
}

éŒ¯èª¤è™•ç†ï¼š
{
  "success": false,
  "error": "ç”¨æˆ¶åå·²å­˜åœ¨",
  "code": 400
}
```

##### 3.2.1.3 ç·¨è¼¯ç”¨æˆ¶ API

```javascript
// æ›´æ–°ç”¨æˆ¶è³‡æ–™
PUT /api/admin/users/{user_id}

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "real_name": "ç‹å¤§æ˜",           // å¯é¸ï¼Œæ›´æ–°çœŸå¯¦å§“å
  "role": "admin",                // å¯é¸ï¼Œæ›´æ–°è§’è‰²
  "is_active": false              // å¯é¸ï¼Œåœç”¨/å•Ÿç”¨å¸³è™Ÿ
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "user_id": "USER003",
    "username": "wangxiaoming",
    "real_name": "ç‹å¤§æ˜",
    "role": "admin",
    "is_active": false,
    "updated_at": "2026-01-16 11:00:00"
  }
}
```

##### 3.2.1.4 é‡è¨­å¯†ç¢¼ API

```javascript
// ä¸»ç®¡é‡è¨­ç”¨æˆ¶å¯†ç¢¼
POST /api/admin/users/{user_id}/reset-password

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "new_password": "newpass123"    // æ–°å¯†ç¢¼
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "message": "å¯†ç¢¼å·²é‡è¨­ç‚ºï¼šnewpass123"
}

é‚è¼¯ï¼š
1. æª¢æŸ¥ä¸»ç®¡æ¬Šé™
2. æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å­˜åœ¨
3. åŠ å¯†æ–°å¯†ç¢¼ä¸¦æ›´æ–°
4. è¨˜éŒ„æ“ä½œæ—¥èªŒï¼ˆå¯é¸ï¼‰
5. å»ºè­°ï¼šå¼·åˆ¶ç”¨æˆ¶ä¸‹æ¬¡ç™»å…¥æ™‚ä¿®æ”¹å¯†ç¢¼
```

##### 3.2.1.5 åœç”¨/å•Ÿç”¨ç”¨æˆ¶

```javascript
// åœç”¨ç”¨æˆ¶
POST /api/admin/users/{user_id}/deactivate

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

é‚è¼¯ï¼š
1. è¨­ç½® is_active = false
2. è©²ç”¨æˆ¶ç„¡æ³•å†ç™»å…¥
3. å·²è² è²¬çš„ç”¢å“ä¸å—å½±éŸ¿ï¼ˆç”¢å“é‚„åœ¨ï¼‰
4. å»ºè­°ï¼šå½ˆå‡ºç¢ºèªæ¡†ã€Œæ˜¯å¦è¦å°‡è©²ç”¨æˆ¶çš„ç”¢å“è½‰ç§»çµ¦å…¶ä»–äººï¼Ÿã€

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "message": "ç”¨æˆ¶å·²åœç”¨",
  "affected_products": 15,        // è©²ç”¨æˆ¶è² è²¬çš„ç”¢å“æ•¸
  "warning": "è©²ç”¨æˆ¶æœ‰ 15 å€‹ç”¢å“éœ€è¦è½‰ç§»"
}
```

##### 3.2.1.6 æŸ¥è©¢ç”¨æˆ¶åˆ—è¡¨ API

```javascript
// ç²å–æ‰€æœ‰ç”¨æˆ¶åˆ—è¡¨
GET /api/admin/users

åƒæ•¸ï¼š
- role: ç¯©é¸è§’è‰²ï¼ˆadmin / staffï¼‰
- is_active: ç¯©é¸ç‹€æ…‹ï¼ˆtrue / falseï¼‰
- search: æœå°‹é—œéµå­—ï¼ˆç”¨æˆ¶åæˆ–å§“åï¼‰

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": [
    {
      "user_id": "USER001",
      "username": "admin",
      "real_name": "æç¶“ç†",
      "role": "admin",
      "is_active": true,
      "created_at": "2024-12-01",
      "product_count": 0           // è² è²¬çš„ç”¢å“æ•¸
    },
    {
      "user_id": "USER002",
      "username": "wangxiaoming",
      "real_name": "ç‹å°æ˜",
      "role": "staff",
      "is_active": true,
      "created_at": "2025-01-10",
      "product_count": 15
    },
    ...
  ]
}
```

#### 3.2.2 ç”¢å“è½‰ç§»åŠŸèƒ½ï¼ˆä¸»ç®¡å°ˆç”¨ï¼‰

##### åŠŸèƒ½æ¦‚è¿°
ä¸»ç®¡å¯ä»¥å°‡ç”¢å“å¾ä¸€å€‹æ¥­å‹™å“¡è½‰ç§»çµ¦å¦ä¸€å€‹æ¥­å‹™å“¡ï¼Œç”¨æ–¼è™•ç†äººå“¡èª¿å‹•ã€é›¢è·ã€å·¥ä½œé‡å¹³è¡¡ç­‰æƒ…æ³ã€‚

##### 3.2.2.1 å–®å€‹ç”¢å“è½‰ç§»

```javascript
// è½‰ç§»å–®å€‹ç”¢å“
POST /api/admin/products/{product_id}/transfer

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "new_handler_id": "USER003",    // æ–°è² è²¬äººçš„ç”¨æˆ¶ID
  "reason": "ç‹å°æ˜è«‹å‡"           // è½‰ç§»åŸå› ï¼ˆå¯é¸ï¼‰
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "product_id": "PR001",
    "product_name": "ç´…è‰²æ¯å­",
    "from_handler": "ç‹å°æ˜",
    "to_handler": "å¼µå°è¯",
    "transferred_by": "æç¶“ç†",
    "transfer_date": "2026-01-16",
    "reason": "ç‹å°æ˜è«‹å‡"
  }
}

é‚è¼¯ï¼š
1. æª¢æŸ¥ä¸»ç®¡æ¬Šé™
2. æª¢æŸ¥ç”¢å“æ˜¯å¦å­˜åœ¨
3. æª¢æŸ¥æ–°è² è²¬äººæ˜¯å¦å­˜åœ¨ä¸”ç‚º staff
4. æ›´æ–°ç”¢å“çš„ handler_id
5. è¨˜éŒ„åˆ° product_handover_log è¡¨
6. æª”æ¡ˆè³‡æ–™å¤¾ä¸å‹•ï¼ˆä¿ç•™åœ¨åŸä½ç½®ï¼‰
7. æ­·å²è¨˜éŒ„ä¿ç•™åŸæ“ä½œäºº
8. ç™¼é€é€šçŸ¥çµ¦æ–°è² è²¬äººï¼ˆå¯é¸ï¼‰
```

##### 3.2.2.2 æ‰¹é‡ç”¢å“è½‰ç§»

```javascript
// æ‰¹é‡è½‰ç§»ç”¢å“ï¼ˆä¾‹å¦‚ï¼šæŸäººé›¢è·ï¼Œä¸€æ¬¡è½‰ç§»æ‰€æœ‰ç”¢å“ï¼‰
POST /api/admin/products/batch-transfer

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è«‹æ±‚æ•¸æ“šï¼š
{
  "from_handler_id": "USER002",   // åŸè² è²¬äºº
  "to_handler_id": "USER003",     // æ–°è² è²¬äºº
  "product_ids": [                // è¦è½‰ç§»çš„ç”¢å“IDåˆ—è¡¨ï¼ˆå¯é¸ï¼Œä¸å¡«å‰‡å…¨éƒ¨è½‰ç§»ï¼‰
    "PR001",
    "PR005",
    "PR012"
  ],
  "reason": "ç‹å°æ˜é›¢è·"
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "transferred_count": 3,
    "from_handler": "ç‹å°æ˜",
    "to_handler": "å¼µå°è¯",
    "product_list": [
      "PR001 - ç´…è‰²æ¯å­",
      "PR005 - è—è‰²ç›¤å­",
      "PR012 - ç¶ è‰²ç¢—"
    ]
  }
}

é‚è¼¯ï¼š
1. æª¢æŸ¥ä¸»ç®¡æ¬Šé™
2. å¦‚æœæ²’æœ‰æŒ‡å®š product_idsï¼Œå‰‡è½‰ç§»è©²ç”¨æˆ¶çš„æ‰€æœ‰ç”¢å“
3. æ‰¹é‡æ›´æ–°ç”¢å“çš„ handler_id
4. æ‰¹é‡è¨˜éŒ„åˆ° product_handover_log
5. è¿”å›è½‰ç§»æˆåŠŸçš„ç”¢å“åˆ—è¡¨
```

##### 3.2.2.3 ç”¢å“è½‰ç§»ç•Œé¢

```
ä¸»ç®¡åœ¨è¨‚å–®è©³æƒ…é æŸ¥çœ‹ç”¢å“æ™‚ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¢å“1ï¼šç´…è‰²æ¯å­                      â”‚
â”‚ ğŸ‘¤ è² è²¬äººï¼šç‹å°æ˜                    â”‚
â”‚ ğŸ“Š ç‹€æ…‹ï¼šåœ–ç¨¿ç¢ºèªä¸­                  â”‚
â”‚                                     â”‚
â”‚ [æŸ¥çœ‹è©³æƒ…] [æ›´æ–°ç‹€æ…‹] [è½‰ç§»è² è²¬äºº]   â”‚â† ä¸»ç®¡å°ˆç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é»æ“Šã€Œè½‰ç§»è² è²¬äººã€å¾Œå½ˆå‡º Modalï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½‰ç§»ç”¢å“è² è²¬äºº                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ç”¢å“ï¼šç”¢å“1 - ç´…è‰²æ¯å­               â”‚
â”‚ ç•¶å‰è² è²¬äººï¼šç‹å°æ˜                   â”‚
â”‚                                     â”‚
â”‚ æ–°è² è²¬äººï¼š                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”½ é¸æ“‡æ¥­å‹™å“¡                    â”‚ â”‚
â”‚ â”‚   â€¢ å¼µå°è¯                       â”‚ â”‚
â”‚ â”‚   â€¢ æå¿—èª                        â”‚ â”‚
â”‚ â”‚   â€¢ é™³ç¾ç²                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ è½‰ç§»åŸå› ï¼ˆå¯é¸ï¼‰ï¼š                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç‹å°æ˜è«‹å‡ä¸€å€‹æœˆ                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ âš ï¸ æ³¨æ„ï¼š                            â”‚
â”‚ â€¢ æª”æ¡ˆå’Œæ­·å²è¨˜éŒ„å°‡ä¿ç•™               â”‚
â”‚ â€¢ æ–°è² è²¬äººå¯ä»¥æŸ¥çœ‹æ‰€æœ‰è³‡æ–™           â”‚
â”‚ â€¢ åŸè² è²¬äººå°‡ç„¡æ³•å†è¨ªå•æ­¤ç”¢å“         â”‚
â”‚                                     â”‚
â”‚          [å–æ¶ˆ]    [ç¢ºèªè½‰ç§»]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 3.2.2.4 æ‰¹é‡è½‰ç§»ç•Œé¢ï¼ˆç”¨æˆ¶ç®¡ç†é ï¼‰

```
åœ¨ç”¨æˆ¶ç®¡ç†é é¢ï¼Œç•¶ä¸»ç®¡è¦åœç”¨æŸå€‹æ¥­å‹™å“¡æ™‚ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœç”¨ç”¨æˆ¶ï¼šç‹å°æ˜                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ âš ï¸ è©²ç”¨æˆ¶è² è²¬ 15 å€‹ç”¢å“              â”‚
â”‚                                     â”‚
â”‚ è«‹é¸æ“‡è™•ç†æ–¹å¼ï¼š                     â”‚
â”‚                                     â”‚
â”‚ â—‹ ä¿ç•™ç”¢å“ï¼ˆä¸è½‰ç§»ï¼Œç”¢å“è®Šç‚ºç„¡ä¸»ï¼‰   â”‚
â”‚ â— è½‰ç§»çµ¦å…¶ä»–æ¥­å‹™å“¡                   â”‚
â”‚                                     â”‚
â”‚ è½‰ç§»çµ¦ï¼š                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”½ å¼µå°è¯ (ç•¶å‰è² è²¬ 8 å€‹ç”¢å“)    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ è½‰ç§»åŸå› ï¼š                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç‹å°æ˜é›¢è·                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ å°‡è½‰ç§»çš„ç”¢å“ï¼š                       â”‚
â”‚ â€¢ PR001 - ç´…è‰²æ¯å­                  â”‚
â”‚ â€¢ PR005 - è—è‰²ç›¤å­                  â”‚
â”‚ â€¢ PR012 - ç¶ è‰²ç¢—                    â”‚
â”‚ â€¢ ...ï¼ˆå…± 15 å€‹ï¼‰                   â”‚
â”‚                                     â”‚
â”‚          [å–æ¶ˆ]    [ç¢ºèªåœç”¨ä¸¦è½‰ç§»]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.3 ç”¢å“è½‰ç§»è¨˜éŒ„æŸ¥è©¢

##### 3.2.3.1 æŸ¥è©¢è½‰ç§»æ­·å² API

```javascript
// æŸ¥è©¢ç”¢å“çš„è½‰ç§»æ­·å²
GET /api/admin/products/{product_id}/handover-history

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": [
    {
      "transfer_id": "T00001",
      "product_id": "PR001",
      "from_handler": "ç‹å°æ˜",
      "to_handler": "å¼µå°è¯",
      "transferred_by": "æç¶“ç†",
      "transfer_date": "2026-01-16 10:30:00",
      "reason": "ç‹å°æ˜è«‹å‡"
    },
    {
      "transfer_id": "T00002",
      "product_id": "PR001",
      "from_handler": "å¼µå°è¯",
      "to_handler": "æå¿—èª ",
      "transferred_by": "æç¶“ç†",
      "transfer_date": "2026-01-20 14:15:00",
      "reason": "å·¥ä½œé‡å¹³è¡¡"
    }
  ]
}
```

##### 3.2.3.2 æŸ¥è©¢ç”¨æˆ¶çš„è½‰ç§»è¨˜éŒ„

```javascript
// æŸ¥è©¢æŸå€‹ç”¨æˆ¶çš„æ‰€æœ‰è½‰ç§»è¨˜éŒ„ï¼ˆè½‰å‡º + è½‰å…¥ï¼‰
GET /api/admin/users/{user_id}/handover-history

åƒæ•¸ï¼š
- type: 'out' | 'in' | 'all'  // è½‰å‡ºã€è½‰å…¥ã€å…¨éƒ¨

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "user": {
      "user_id": "USER002",
      "real_name": "ç‹å°æ˜"
    },
    "handovers": [
      {
        "type": "out",             // è½‰å‡º
        "product_name": "ç´…è‰²æ¯å­",
        "to_handler": "å¼µå°è¯",
        "transfer_date": "2026-01-16",
        "reason": "è«‹å‡"
      },
      {
        "type": "in",              // è½‰å…¥
        "product_name": "ç¶ è‰²ç¢—",
        "from_handler": "æå¿—èª ",
        "transfer_date": "2026-01-10",
        "reason": "é›¢è·"
      }
    ]
  }
}
```

#### 3.2.4 ä¸»ç®¡å„€è¡¨æ¿ï¼ˆDashboardï¼‰

##### åŠŸèƒ½æ¦‚è¿°
ä¸»ç®¡éœ€è¦ä¸€å€‹ç¸½è¦½é é¢ï¼Œå¿«é€ŸæŸ¥çœ‹ç³»çµ±æ•´é«”ç‹€æ³ã€‚

##### 3.2.4.1 å„€è¡¨æ¿ API

```javascript
// ç²å–ä¸»ç®¡å„€è¡¨æ¿æ•¸æ“š
GET /api/admin/dashboard

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "overview": {
      "total_orders": 50,
      "total_products": 120,
      "total_users": 8,
      "total_files": 350
    },
    "order_status": {
      "red": 5,                   // ç´…ç‡ˆè¨‚å–®æ•¸
      "yellow": 12,               // é»ƒç‡ˆè¨‚å–®æ•¸
      "green": 33                 // ç¶ ç‡ˆè¨‚å–®æ•¸
    },
    "stage_distribution": {       // å„éšæ®µè¨‚å–®åˆ†å¸ƒ
      "æ–°è¨‚å–®": 10,
      "å ±åƒ¹ä¸­": 8,
      "åœ–ç¨¿ç¢ºèªä¸­": 15,
      "æ‰“æ¨£ä¸­": 12,
      "ç”Ÿç”¢ä¸­": 3,
      "å·²å®Œæˆ": 2
    },
    "user_workload": [            // æ¥­å‹™å“¡å·¥ä½œé‡
      {
        "user_id": "USER002",
        "real_name": "ç‹å°æ˜",
        "product_count": 35,
        "red_products": 2,
        "yellow_products": 8
      },
      {
        "user_id": "USER003",
        "real_name": "å¼µå°è¯",
        "product_count": 28,
        "red_products": 1,
        "yellow_products": 5
      },
      ...
    ],
    "recent_activities": [        // æœ€è¿‘æ´»å‹•
      {
        "type": "order_created",
        "user": "æç¶“ç†",
        "order_number": "KC0051",
        "timestamp": "2026-01-16 10:30:00"
      },
      {
        "type": "product_transferred",
        "user": "æç¶“ç†",
        "product_name": "ç´…è‰²æ¯å­",
        "from": "ç‹å°æ˜",
        "to": "å¼µå°è¯",
        "timestamp": "2026-01-16 09:15:00"
      },
      ...
    ]
  }
}
```

##### 3.2.4.2 å„€è¡¨æ¿ç•Œé¢è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»ç®¡å„€è¡¨æ¿                          æç¶“ç† [ç™»å‡º] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ğŸ“Š ç³»çµ±æ¦‚æ³                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ â”‚ è¨‚å–®  â”‚ ç”¢å“  â”‚ ç”¨æˆ¶  â”‚ æª”æ¡ˆ  â”‚              â”‚
â”‚ â”‚  50   â”‚ 120   â”‚   8   â”‚ 350   â”‚              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                 â”‚
â”‚ ğŸš¦ è¨‚å–®ç‹€æ…‹åˆ†å¸ƒ                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”´ ç´…ç‡ˆï¼š5 å€‹  (10%)  â–ˆâ–ˆâ–ˆ                    â”‚ â”‚
â”‚ â”‚ ğŸŸ¡ é»ƒç‡ˆï¼š12 å€‹ (24%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                â”‚ â”‚
â”‚ â”‚ ğŸŸ¢ ç¶ ç‡ˆï¼š33 å€‹ (66%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ‘¥ æ¥­å‹™å“¡å·¥ä½œé‡                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç‹å°æ˜ï¼š35 å€‹ç”¢å“  (ğŸ”´2 ğŸŸ¡8 ğŸŸ¢25)            â”‚ â”‚
â”‚ â”‚ å¼µå°è¯ï¼š28 å€‹ç”¢å“  (ğŸ”´1 ğŸŸ¡5 ğŸŸ¢22)            â”‚ â”‚
â”‚ â”‚ æå¿—èª ï¼š22 å€‹ç”¢å“  (ğŸ”´0 ğŸŸ¡3 ğŸŸ¢19)            â”‚ â”‚
â”‚ â”‚ ...                                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ“… æœ€è¿‘æ´»å‹•                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 10:30 æç¶“ç†å‰µå»ºè¨‚å–® #KC0051                 â”‚ â”‚
â”‚ â”‚ 09:15 æç¶“ç†å°‡ã€Œç´…è‰²æ¯å­ã€å¾ç‹å°æ˜è½‰çµ¦å¼µå°è¯  â”‚ â”‚
â”‚ â”‚ 08:45 ç‹å°æ˜ä¸Šå‚³æª”æ¡ˆåˆ°ç”¢å“ PR023             â”‚ â”‚
â”‚ â”‚ ...                                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ [ç”¨æˆ¶ç®¡ç†] [è¨‚å–®åˆ—è¡¨] [ç³»çµ±è¨­å®š]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.5 æ¬Šé™æª¢æŸ¥è£é£¾å™¨

##### å¾Œç«¯å¯¦ç¾

```python
# decorators.py

from functools import wraps
from flask import session, jsonify

def admin_required(f):
    """åƒ…ä¸»ç®¡å¯è¨ªå•"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if not session.get('logged_in'):
            return jsonify({'success': False, 'error': 'æœªç™»å…¥', 'code': 401}), 401
        
        if session.get('role') != 'admin':
            return jsonify({'success': False, 'error': 'æ¬Šé™ä¸è¶³', 'code': 403}), 403
        
        return f(*args, **kwargs)
    return decorated_function

def login_required(f):
    """å¿…é ˆç™»å…¥"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if not session.get('logged_in'):
            return jsonify({'success': False, 'error': 'æœªç™»å…¥', 'code': 401}), 401
        
        return f(*args, **kwargs)
    return decorated_function

# ä½¿ç”¨ç¯„ä¾‹
@app.route('/api/admin/users', methods=['POST'])
@admin_required
def create_user():
    # åªæœ‰ä¸»ç®¡èƒ½åŸ·è¡Œ
    pass

@app.route('/api/products/<product_id>', methods=['GET'])
@login_required
def get_product(product_id):
    # ä»»ä½•ç™»å…¥ç”¨æˆ¶éƒ½èƒ½åŸ·è¡Œ
    pass
```

#### 3.2.6 ç”¨æˆ¶ä¿®æ”¹å¯†ç¢¼åŠŸèƒ½

##### åŠŸèƒ½æ¦‚è¿°
æ¯å€‹ç”¨æˆ¶ï¼ˆåŒ…æ‹¬æ¥­å‹™å“¡ï¼‰éƒ½å¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼ï¼Œä¸èƒ½ä¿®æ”¹åˆ¥äººçš„å¯†ç¢¼ã€‚

##### API è¨­è¨ˆ

```javascript
// ç”¨æˆ¶ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼
POST /api/user/change-password

æ¬Šé™ï¼šç™»å…¥ç”¨æˆ¶

è«‹æ±‚æ•¸æ“šï¼š
{
  "old_password": "oldpass123",
  "new_password": "newpass456",
  "confirm_password": "newpass456"
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "message": "å¯†ç¢¼ä¿®æ”¹æˆåŠŸ"
}

éŒ¯èª¤è™•ç†ï¼š
{
  "success": false,
  "error": "åŸå¯†ç¢¼éŒ¯èª¤",
  "code": 400
}

é‚è¼¯ï¼š
1. é©—è­‰åŸå¯†ç¢¼æ˜¯å¦æ­£ç¢º
2. æª¢æŸ¥æ–°å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼æ˜¯å¦ä¸€è‡´
3. é©—è­‰æ–°å¯†ç¢¼å¼·åº¦ï¼ˆè‡³å°‘6ä½ï¼‰
4. åŠ å¯†æ–°å¯†ç¢¼ä¸¦æ›´æ–°
5. è¨˜éŒ„åˆ°æ“ä½œæ—¥èªŒ
```

##### å‰ç«¯ç•Œé¢

```
ç”¨æˆ¶é»æ“Šå³ä¸Šè§’ç”¨æˆ¶å â†’ ä¸‹æ‹‰é¸å–®

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‹å°æ˜ â–¼                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ‘¤ å€‹äººè³‡æ–™]              â”‚
â”‚ [ğŸ”‘ ä¿®æ”¹å¯†ç¢¼]              â”‚
â”‚ [ğŸšª ç™»å‡º]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é»æ“Šã€Œä¿®æ”¹å¯†ç¢¼ã€å¾Œå½ˆå‡º Modalï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿®æ”¹å¯†ç¢¼                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚
â”‚ åŸå¯†ç¢¼ï¼š                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚
â”‚ æ–°å¯†ç¢¼ï¼š                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚
â”‚ ç¢ºèªæ–°å¯†ç¢¼ï¼š                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚
â”‚ â„¹ï¸ å¯†ç¢¼è‡³å°‘ 6 ä½            â”‚
â”‚                            â”‚
â”‚      [å–æ¶ˆ]    [ç¢ºèªä¿®æ”¹]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.7 æ“ä½œæ—¥èªŒç³»çµ±

##### åŠŸèƒ½æ¦‚è¿°
è¨˜éŒ„ç³»çµ±ä¸­çš„é—œéµæ“ä½œï¼Œç”¨æ–¼å¯©è¨ˆè¿½è¹¤å’Œå•é¡Œå®šä½ã€‚

##### è¨˜éŒ„çš„æ“ä½œé¡å‹

```
éœ€è¦è¨˜éŒ„ï¼š
âœ… create_order        - å‰µå»ºè¨‚å–®
âœ… create_product      - å‰µå»ºç”¢å“
âœ… transfer_product    - è½‰ç§»ç”¢å“
âœ… create_user         - å‰µå»ºç”¨æˆ¶
âœ… modify_user         - ä¿®æ”¹ç”¨æˆ¶
âœ… deactivate_user     - åœç”¨ç”¨æˆ¶
âœ… reset_password      - é‡è¨­å¯†ç¢¼
âœ… delete_file         - åˆªé™¤æª”æ¡ˆï¼ˆå¤§é‡åˆªé™¤æ™‚è¨˜éŒ„ï¼‰

ä¸éœ€è¦è¨˜éŒ„ï¼š
âŒ æŸ¥çœ‹æ“ä½œï¼ˆå¤ªé »ç¹ï¼‰
âŒ ä¸Šå‚³æª”æ¡ˆï¼ˆæª”æ¡ˆè¡¨å·²æœ‰è¨˜éŒ„ï¼‰
âŒ æ›´æ–°ç”¢å“ç‹€æ…‹ï¼ˆç‹€æ…‹æ­·å²è¡¨å·²æœ‰è¨˜éŒ„ï¼‰
```

##### API è¨­è¨ˆ

```javascript
// æŸ¥è©¢æ“ä½œæ—¥èªŒï¼ˆä¸»ç®¡å°ˆç”¨ï¼‰
GET /api/admin/logs

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

åƒæ•¸ï¼š
- user_id: ç¯©é¸ç‰¹å®šç”¨æˆ¶çš„æ“ä½œ
- operation_type: ç¯©é¸æ“ä½œé¡å‹
- start_date: é–‹å§‹æ—¥æœŸ
- end_date: çµæŸæ—¥æœŸ
- page: é ç¢¼
- per_page: æ¯é æ•¸é‡

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": "LOG00001",
        "user": "æç¶“ç†",
        "user_id": "USER001",
        "operation_type": "create_order",
        "operation_desc": "å‰µå»ºè¨‚å–® #KC0051",
        "order_number": "KC0051",
        "ip_address": "192.168.1.100",
        "created_at": "2026-01-16 10:30:00"
      },
      {
        "id": "LOG00002",
        "user": "æç¶“ç†",
        "user_id": "USER001",
        "operation_type": "transfer_product",
        "operation_desc": "å°‡ç”¢å“ã€Œç´…è‰²æ¯å­ã€å¾ç‹å°æ˜è½‰ç§»çµ¦å¼µå°è¯",
        "product_id": "PR001",
        "target_user": "å¼µå°è¯",
        "details": {
          "from_handler": "ç‹å°æ˜",
          "to_handler": "å¼µå°è¯",
          "reason": "å·¥ä½œé‡å¹³è¡¡"
        },
        "created_at": "2026-01-16 09:15:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 5,
      "total_records": 98
    }
  }
}
```

##### å‰ç«¯ç•Œé¢

```
ä¸»ç®¡å„€è¡¨æ¿ä¸­æ·»åŠ ã€Œæ“ä½œæ—¥èªŒã€å…¥å£ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œæ—¥èªŒ                      [ç¯©é¸â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ä»Šå¤© 10:30                          â”‚
â”‚ ğŸ‘¤ æç¶“ç† å‰µå»ºè¨‚å–®                  â”‚
â”‚ ğŸ“‹ è¨‚å–®è™Ÿï¼š#KC0051                  â”‚
â”‚ ğŸ’» IP: 192.168.1.100               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                     â”‚
â”‚ ä»Šå¤© 09:15                          â”‚
â”‚ ğŸ‘¤ æç¶“ç† è½‰ç§»ç”¢å“                  â”‚
â”‚ ğŸ“¦ ç”¢å“ï¼šç´…è‰²æ¯å­                   â”‚
â”‚ â†ªï¸  å¾ç‹å°æ˜ â†’ å¼µå°è¯               â”‚
â”‚ ğŸ’» IP: 192.168.1.100               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                     â”‚
â”‚ æ˜¨å¤© 16:40                          â”‚
â”‚ ğŸ‘¤ æç¶“ç† å‰µå»ºç”¨æˆ¶                  â”‚
â”‚ ğŸ‘¥ ç”¨æˆ¶ï¼šé™³ç¾ç² (staff)             â”‚
â”‚ ğŸ’» IP: 192.168.1.100               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                     â”‚
â”‚         [è¼‰å…¥æ›´å¤š]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### è¨˜éŒ„æ“ä½œçš„å‡½æ•¸ï¼ˆå¾Œç«¯ï¼‰

```python
# utils.py

def log_operation(user_id, operation_type, operation_desc, **kwargs):
    """è¨˜éŒ„æ“ä½œæ—¥èªŒ"""
    from flask import request
    
    log = OperationLog(
        user_id=user_id,
        operation_type=operation_type,
        operation_desc=operation_desc,
        order_number=kwargs.get('order_number'),
        product_id=kwargs.get('product_id'),
        target_user_id=kwargs.get('target_user_id'),
        details=kwargs.get('details'),
        ip_address=request.remote_addr,
        user_agent=request.headers.get('User-Agent'),
        created_at=datetime.now()
    )
    db.session.add(log)
    db.session.commit()

# ä½¿ç”¨ç¯„ä¾‹
@app.route('/api/orders', methods=['POST'])
@admin_required
def create_order():
    # ... å‰µå»ºè¨‚å–®é‚è¼¯ ...
    
    # è¨˜éŒ„æ—¥èªŒ
    log_operation(
        user_id=session.get('user_id'),
        operation_type='create_order',
        operation_desc=f'å‰µå»ºè¨‚å–® #{order_number}',
        order_number=order_number
    )
    
    return jsonify({'success': True})
```

#### 3.2.8 æ•¸æ“šåŒ¯å‡ºåŠŸèƒ½

##### åŠŸèƒ½æ¦‚è¿°
ä¸»ç®¡å¯ä»¥åŒ¯å‡ºè¨‚å–®åˆ—è¡¨ã€ç”¢å“åˆ—è¡¨ç‚º Excel æ–‡ä»¶ï¼Œæˆ–æ‰¹é‡ä¸‹è¼‰è¨‚å–®çš„æ‰€æœ‰æª”æ¡ˆç‚º ZIPã€‚

##### 3.2.8.1 åŒ¯å‡ºè¨‚å–®åˆ—è¡¨ï¼ˆExcelï¼‰

```javascript
// åŒ¯å‡ºè¨‚å–®åˆ—è¡¨
GET /api/admin/export/orders

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

åƒæ•¸ï¼š
- filters: ç¯©é¸æ¢ä»¶ï¼ˆred, yellow, green ç­‰ï¼‰
- format: 'excel' æˆ– 'csv'

è¿”å›ï¼š
- Excel æª”æ¡ˆä¸‹è¼‰

Excel å…§å®¹ï¼š
| è¨‚å–®è™Ÿ    | å®¢æˆ¶åç¨± | è¨‚å–®æ—¥æœŸ   | ç”¢å“æ•¸ | ç‹€æ…‹ | ç­‰å¾…å¤©æ•¸ |
|----------|---------|-----------|--------|------|---------|
| KC0001   | ABCå…¬å¸  | 2026-01-10| 3      | é»ƒç‡ˆ  | 5       |
| KC0002   | XYZä¼æ¥­  | 2026-01-12| 2      | ç¶ ç‡ˆ  | 3       |
| ...      | ...     | ...       | ...    | ...  | ...     |
```

##### 3.2.8.2 åŒ¯å‡ºç”¢å“åˆ—è¡¨ï¼ˆExcelï¼‰

```javascript
// åŒ¯å‡ºç”¢å“åˆ—è¡¨
GET /api/admin/export/products

æ¬Šé™ï¼šåƒ…ä¸»ç®¡ï¼ˆadminï¼‰

åƒæ•¸ï¼š
- order_number: ç¯©é¸ç‰¹å®šè¨‚å–®ï¼ˆå¯é¸ï¼‰
- handler_id: ç¯©é¸ç‰¹å®šæ¥­å‹™å“¡ï¼ˆå¯é¸ï¼‰
- format: 'excel' æˆ– 'csv'

è¿”å›ï¼š
- Excel æª”æ¡ˆä¸‹è¼‰

Excel å…§å®¹ï¼š
| è¨‚å–®è™Ÿ  | ç”¢å“åç¨± | ç”¢å“ç·¨è™Ÿ  | è² è²¬äºº | ç‹€æ…‹      | å¤©æ•¸ | æª”æ¡ˆæ•¸ |
|--------|---------|----------|--------|-----------|------|--------|
| KC0001 | ç´…è‰²æ¯å­ | P-RED-01 | ç‹å°æ˜  | åœ–ç¨¿ç¢ºèªä¸­ | 5    | 8      |
| KC0001 | è—è‰²ç›¤å­ | P-BLU-01 | å¼µå°è¯  | æ‰“æ¨£ä¸­     | 3    | 5      |
| ...    | ...     | ...      | ...    | ...       | ...  | ...    |
```

##### 3.2.8.3 æ‰¹é‡ä¸‹è¼‰è¨‚å–®æª”æ¡ˆï¼ˆZIPï¼‰

```javascript
// ä¸‹è¼‰è¨‚å–®æ‰€æœ‰æª”æ¡ˆ
GET /api/orders/{order_number}/download-all

æ¬Šé™ï¼šä¸»ç®¡æˆ–è©²è¨‚å–®çš„ç›¸é—œæ¥­å‹™å“¡

è¿”å›ï¼š
- ZIP æª”æ¡ˆä¸‹è¼‰

ZIP çµæ§‹ï¼š
KC0001_æ‰€æœ‰æª”æ¡ˆ.zip
â”œâ”€â”€ ä¸»è¨‚å–®æª”æ¡ˆ/
â”‚   â”œâ”€â”€ åˆç´„.pdf
â”‚   â”œâ”€â”€ å ±åƒ¹å–®.xlsx
â”‚   â””â”€â”€ è¦æ ¼æ›¸.doc
â”œâ”€â”€ ç”¢å“1_ç´…è‰²æ¯å­/
â”‚   â”œâ”€â”€ åœ–ç¨¿v1.jpg
â”‚   â”œâ”€â”€ åœ–ç¨¿v2.jpg
â”‚   â””â”€â”€ æ¨£å“ç…§ç‰‡.jpg
â””â”€â”€ ç”¢å“2_è—è‰²ç›¤å­/
    â”œâ”€â”€ è¨­è¨ˆåœ–.pdf
    â””â”€â”€ æ‰“æ¨£ç…§ç‰‡.jpg
```

##### å‰ç«¯ç•Œé¢

```
ä¸»ç®¡åœ¨è¨‚å–®åˆ—è¡¨é é ‚éƒ¨æ·»åŠ åŒ¯å‡ºæŒ‰éˆ•ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç¯©é¸â–¼] [åŒ¯å‡ºâ–¼]              [æœå°‹] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
     é»æ“Šã€ŒåŒ¯å‡ºã€å±•é–‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š åŒ¯å‡ºè¨‚å–®åˆ—è¡¨ (Excel)â”‚
â”‚ ğŸ“¦ åŒ¯å‡ºç”¢å“åˆ—è¡¨ (Excel)â”‚
â”‚ ğŸ’¾ åŒ¯å‡ºç‚º CSV         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœ¨è¨‚å–®è©³æƒ…é æ·»åŠ ã€Œä¸‹è¼‰å…¨éƒ¨æª”æ¡ˆã€æŒ‰éˆ•ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¨‚å–® #KC0001                         â”‚
â”‚ [ç·¨è¼¯] [ä¸‹è¼‰å…¨éƒ¨æª”æ¡ˆ ZIP]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### å¯¦ç¾ä»£ç¢¼ï¼ˆå¾Œç«¯ï¼‰

```python
import openpyxl
import zipfile
import io
from flask import send_file

@app.route('/api/admin/export/orders', methods=['GET'])
@admin_required
def export_orders():
    """åŒ¯å‡ºè¨‚å–®åˆ—è¡¨ç‚º Excel"""
    # æŸ¥è©¢è¨‚å–®
    orders = Order.query.all()
    
    # å‰µå»º Excel
    wb = openpyxl.Workbook()
    ws = wb.active
    ws.title = "è¨‚å–®åˆ—è¡¨"
    
    # è¡¨é ­
    ws.append(['è¨‚å–®è™Ÿ', 'å®¢æˆ¶åç¨±', 'è¨‚å–®æ—¥æœŸ', 'ç”¢å“æ•¸', 'ç‹€æ…‹', 'ç­‰å¾…å¤©æ•¸'])
    
    # æ•¸æ“š
    for order in orders:
        ws.append([
            order.order_number,
            order.customer_name,
            order.order_date.strftime('%Y-%m-%d'),
            len(order.products),
            order.status_light,
            order.waiting_days
        ])
    
    # ä¿å­˜åˆ°å…§å­˜
    output = io.BytesIO()
    wb.save(output)
    output.seek(0)
    
    # è¿”å›æª”æ¡ˆ
    return send_file(
        output,
        mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        as_attachment=True,
        download_name=f'è¨‚å–®åˆ—è¡¨_{datetime.now().strftime("%Y%m%d")}.xlsx'
    )

@app.route('/api/orders/<order_number>/download-all', methods=['GET'])
@login_required
def download_all_files(order_number):
    """ä¸‹è¼‰è¨‚å–®æ‰€æœ‰æª”æ¡ˆç‚º ZIP"""
    # æŸ¥è©¢è¨‚å–®å’Œæª”æ¡ˆ
    order = Order.query.filter_by(order_number=order_number).first()
    if not order:
        return jsonify({'error': 'è¨‚å–®ä¸å­˜åœ¨'}), 404
    
    # å‰µå»º ZIP
    memory_file = io.BytesIO()
    with zipfile.ZipFile(memory_file, 'w', zipfile.ZIP_DEFLATED) as zf:
        # ä¸»è¨‚å–®æª”æ¡ˆ
        for file in order.order_files:
            if not file.is_deleted:
                zf.write(file.file_path, f'ä¸»è¨‚å–®æª”æ¡ˆ/{file.filename}')
        
        # ç”¢å“æª”æ¡ˆ
        for product in order.products:
            for file in product.images:
                if not file.is_deleted:
                    zf.write(file.file_path, f'{product.product_name}/{file.filename}')
    
    memory_file.seek(0)
    
    return send_file(
        memory_file,
        mimetype='application/zip',
        as_attachment=True,
        download_name=f'{order_number}_æ‰€æœ‰æª”æ¡ˆ.zip'
    )
```

#### 3.2.9 å®¢æˆ¶åç¨±è‡ªå‹•å»ºè­°

##### åŠŸèƒ½æ¦‚è¿°
å‰µå»ºè¨‚å–®æ™‚ï¼Œå¾æ­·å²è¨‚å–®ä¸­è‡ªå‹•æå–å®¢æˆ¶åˆ—è¡¨ï¼Œæä¾›ä¸‹æ‹‰é¸æ“‡ï¼Œé¿å…æ‰“éŒ¯å®¢æˆ¶åç¨±ã€‚

##### API è¨­è¨ˆ

```javascript
// ç²å–å®¢æˆ¶å»ºè­°åˆ—è¡¨
GET /api/customers/suggestions

æ¬Šé™ï¼šç™»å…¥ç”¨æˆ¶

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "customers": [
      "ABCå…¬å¸",
      "XYZä¼æ¥­",
      "å°ç©é›»",
      "è¯ç™¼ç§‘",
      "é´»æµ·ç²¾å¯†",
      ...
    ]
  }
}

é‚è¼¯ï¼š
1. å¾ orders è¡¨ä¸­æå–æ‰€æœ‰ä¸é‡è¤‡çš„ customer_name
2. æŒ‰å­—æ¯æ’åºï¼ˆæ”¯æŒä¸­æ–‡æ’åºï¼‰
3. è¿”å›åˆ—è¡¨
```

##### å‰ç«¯å¯¦ç¾

```javascript
// å‰µå»ºè¨‚å–® Modal
let customerList = [];

// è¼‰å…¥å®¢æˆ¶åˆ—è¡¨
async function loadCustomers() {
  const response = await fetch('/api/customers/suggestions');
  const data = await response.json();
  customerList = data.data.customers;
  
  // åˆå§‹åŒ–è‡ªå‹•å®Œæˆ
  initCustomerAutocomplete();
}

// åˆå§‹åŒ–è‡ªå‹•å®Œæˆï¼ˆä½¿ç”¨ datalist æˆ–ç¬¬ä¸‰æ–¹çµ„ä»¶ï¼‰
function initCustomerAutocomplete() {
  const input = document.getElementById('customer-input');
  const datalist = document.getElementById('customer-list');
  
  // æ¸…ç©º
  datalist.innerHTML = '';
  
  // æ·»åŠ é¸é …
  customerList.forEach(customer => {
    const option = document.createElement('option');
    option.value = customer;
    datalist.appendChild(option);
  });
}

// HTML
<input 
  type="text" 
  id="customer-input" 
  list="customer-list" 
  placeholder="é¸æ“‡æˆ–è¼¸å…¥å®¢æˆ¶åç¨±"
/>
<datalist id="customer-list"></datalist>
```

##### ç•Œé¢æ•ˆæœ

```
å‰µå»ºè¨‚å–® Modalï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰µå»ºæ–°è¨‚å–®                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¨‚å–®è™Ÿï¼š                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ KC0051                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚
â”‚ å®¢æˆ¶åç¨±ï¼š                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ABâ–¼                        â”‚ â”‚â† è¼¸å…¥ã€ŒABã€
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ABCå…¬å¸                    â”‚ â”‚â† è‡ªå‹•å»ºè­°
â”‚ â”‚ ABCDä¼æ¥­                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚
â”‚ æˆ–ç›´æ¥è¼¸å…¥æ–°å®¢æˆ¶åç¨±ï¼š          â”‚
â”‚ ä¹Ÿå¯ä»¥ä¸é¸ï¼Œç›´æ¥æ‰“æ–°çš„å®¢æˆ¶å    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.10 é€šçŸ¥ç³»çµ±ï¼ˆç«™å…§é€šçŸ¥ï¼‰

##### åŠŸèƒ½æ¦‚è¿°
å°åœ˜éšŠå°ˆç”¨çš„ç°¡åŒ–é€šçŸ¥ç³»çµ±ï¼Œé€šçŸ¥é—œéµæ“ä½œå’Œæé†’äº‹é …ã€‚

##### é€šçŸ¥å ´æ™¯

```
1. å‰µå»ºè¨‚å–®
   è§¸ç™¼ï¼šä¸»ç®¡å‰µå»ºè¨‚å–®
   é€šçŸ¥å°è±¡ï¼šæ‰€æœ‰æ¥­å‹™å“¡ï¼ˆstaff è§’è‰²ï¼‰
   å…§å®¹ï¼šã€Œæç¶“ç†å‰µå»ºäº†æ–°è¨‚å–® #KC0051 - ABCå…¬å¸ã€
   
2. å‰µå»ºç”¢å“
   è§¸ç™¼ï¼šæ¥­å‹™å“¡å‰µå»ºç”¢å“
   é€šçŸ¥å°è±¡ï¼šä¸»ç®¡ï¼ˆadmin è§’è‰²ï¼‰
   å…§å®¹ï¼šã€Œç‹å°æ˜åœ¨è¨‚å–® #KC0001 ä¸‹å‰µå»ºäº†ç”¢å“ã€Œç´…è‰²æ¯å­ã€ã€
   
3. è½‰ç§»ç”¢å“
   è§¸ç™¼ï¼šä¸»ç®¡è½‰ç§»ç”¢å“
   é€šçŸ¥å°è±¡ï¼šæ–°è² è²¬äºº + åŸè² è²¬äºº
   å…§å®¹ï¼šã€Œæç¶“ç†å°‡ç”¢å“ã€Œç´…è‰²æ¯å­ã€å¾ç‹å°æ˜è½‰ç§»çµ¦å¼µå°è¯ã€
   
4. è¨‚å–®é€¾æœŸï¼ˆè‡ªå‹•ï¼‰
   è§¸ç™¼ï¼šç³»çµ±å®šæ™‚æª¢æŸ¥ï¼ˆæ¯å¤©ä¸€æ¬¡ï¼‰
   é€šçŸ¥å°è±¡ï¼šè©²è¨‚å–®çš„æ‰€æœ‰ç”¢å“è² è²¬äºº
   å…§å®¹ï¼šã€Œè¨‚å–® #KC0001 å·²é€¾æœŸ 3 å¤©ï¼Œè«‹æ³¨æ„è™•ç†ã€
```

##### API è¨­è¨ˆ

```javascript
// ç²å–ç•¶å‰ç”¨æˆ¶çš„é€šçŸ¥åˆ—è¡¨
GET /api/notifications

æ¬Šé™ï¼šç™»å…¥ç”¨æˆ¶

åƒæ•¸ï¼š
- is_read: true/false/allï¼ˆé»˜èª allï¼‰
- limit: æ•¸é‡é™åˆ¶ï¼ˆé»˜èª 20ï¼‰

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "unread_count": 3,
    "notifications": [
      {
        "id": "NOTIF00001",
        "type": "overdue_alert",
        "title": "è¨‚å–®é€¾æœŸæé†’",
        "message": "è¨‚å–® #KC0001 å·²é€¾æœŸ 3 å¤©ï¼Œè«‹æ³¨æ„è™•ç†",
        "order_number": "KC0001",
        "product_id": null,
        "is_read": false,
        "created_at": "2026-01-16 08:00:00",
        "time_ago": "2å°æ™‚å‰"
      },
      {
        "id": "NOTIF00002",
        "type": "order_created",
        "title": "æ–°è¨‚å–®å‰µå»º",
        "message": "æç¶“ç†å‰µå»ºäº†æ–°è¨‚å–® #KC0051 - ABCå…¬å¸",
        "order_number": "KC0051",
        "product_id": null,
        "is_read": false,
        "created_at": "2026-01-16 10:30:00",
        "time_ago": "30åˆ†é˜å‰"
      },
      {
        "id": "NOTIF00003",
        "type": "product_transferred",
        "title": "ç”¢å“å·²è½‰ç§»",
        "message": "ç”¢å“ã€Œç´…è‰²æ¯å­ã€å·²è½‰ç§»çµ¦ä½ ",
        "order_number": "KC0001",
        "product_id": "PR001",
        "is_read": true,
        "created_at": "2026-01-15 14:20:00",
        "time_ago": "æ˜¨å¤©"
      }
    ]
  }
}

// æ¨™è¨˜é€šçŸ¥ç‚ºå·²è®€
POST /api/notifications/{notification_id}/read

è¿”å›ï¼š
{
  "success": true
}

// æ¨™è¨˜æ‰€æœ‰é€šçŸ¥ç‚ºå·²è®€
POST /api/notifications/read-all

è¿”å›ï¼š
{
  "success": true
}
```

##### å‰ç«¯ç•Œé¢

```
é ‚éƒ¨å°èˆªæ¬„ï¼ˆæ‰€æœ‰é é¢ï¼‰ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¨‚å–®ç³»çµ±    ğŸ”” (3)    ç‹å°æ˜ â–¼       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†‘
          æœªè®€æ•¸

é»æ“Šéˆ´éºå±•é–‹é€šçŸ¥åˆ—è¡¨ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€šçŸ¥ (3æ¢æœªè®€)      [å…¨éƒ¨æ¨™ç‚ºå·²è®€]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ è¨‚å–®é€¾æœŸæé†’              2å°æ™‚å‰ â”‚
â”‚ è¨‚å–® #KC0001 å·²é€¾æœŸ 3 å¤©            â”‚
â”‚ [æŸ¥çœ‹è¨‚å–®]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦ æ–°è¨‚å–®å‰µå»º               30åˆ†é˜å‰ â”‚
â”‚ æç¶“ç†å‰µå»ºäº†æ–°è¨‚å–® #KC0051 - ABCå…¬å¸â”‚
â”‚ [æŸ¥çœ‹è¨‚å–®]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ ç”¢å“å·²è½‰ç§» âœ“                æ˜¨å¤©  â”‚
â”‚ ç”¢å“ã€Œç´…è‰²æ¯å­ã€å·²è½‰ç§»çµ¦ä½            â”‚
â”‚ [æŸ¥çœ‹ç”¢å“]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          [æŸ¥çœ‹å…¨éƒ¨é€šçŸ¥]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ç™¼é€é€šçŸ¥çš„å‡½æ•¸ï¼ˆå¾Œç«¯ï¼‰

```python
# utils.py

def send_notification(user_ids, notification_type, title, message, **kwargs):
    """ç™¼é€é€šçŸ¥çµ¦æŒ‡å®šç”¨æˆ¶"""
    if not isinstance(user_ids, list):
        user_ids = [user_ids]
    
    for user_id in user_ids:
        notification = Notification(
            user_id=user_id,
            type=notification_type,
            title=title,
            message=message,
            order_number=kwargs.get('order_number'),
            product_id=kwargs.get('product_id'),
            is_read=False,
            created_at=datetime.now()
        )
        db.session.add(notification)
    
    db.session.commit()

# ä½¿ç”¨ç¯„ä¾‹ï¼šå‰µå»ºè¨‚å–®æ™‚é€šçŸ¥æ‰€æœ‰æ¥­å‹™å“¡
@app.route('/api/orders', methods=['POST'])
@admin_required
def create_order():
    # ... å‰µå»ºè¨‚å–®é‚è¼¯ ...
    
    # ç²å–æ‰€æœ‰æ¥­å‹™å“¡ID
    staff_ids = [u.id for u in User.query.filter_by(role='staff', is_active=True).all()]
    
    # ç™¼é€é€šçŸ¥
    send_notification(
        user_ids=staff_ids,
        notification_type='order_created',
        title='æ–°è¨‚å–®å‰µå»º',
        message=f'{session.get("real_name")}å‰µå»ºäº†æ–°è¨‚å–® #{order_number} - {customer_name}',
        order_number=order_number
    )
    
    return jsonify({'success': True})

# ä½¿ç”¨ç¯„ä¾‹ï¼šè½‰ç§»ç”¢å“æ™‚é€šçŸ¥æ–°èˆŠè² è²¬äºº
@app.route('/api/admin/products/<product_id>/transfer', methods=['POST'])
@admin_required
def transfer_product(product_id):
    # ... è½‰ç§»ç”¢å“é‚è¼¯ ...
    
    # é€šçŸ¥æ–°è² è²¬äºº
    send_notification(
        user_ids=[new_handler_id],
        notification_type='product_transferred',
        title='ç”¢å“å·²è½‰ç§»',
        message=f'ç”¢å“ã€Œ{product.product_name}ã€å·²è½‰ç§»çµ¦ä½ ',
        order_number=product.order_number,
        product_id=product_id
    )
    
    # é€šçŸ¥åŸè² è²¬äºº
    send_notification(
        user_ids=[old_handler_id],
        notification_type='product_transferred',
        title='ç”¢å“å·²è½‰ç§»',
        message=f'ä½ è² è²¬çš„ç”¢å“ã€Œ{product.product_name}ã€å·²è½‰ç§»çµ¦{new_handler_name}',
        order_number=product.order_number,
        product_id=product_id
    )
    
    return jsonify({'success': True})
```

##### è‡ªå‹•é€¾æœŸæª¢æŸ¥ï¼ˆå®šæ™‚ä»»å‹™ï¼‰

```python
# tasks.py

from apscheduler.schedulers.background import BackgroundScheduler

def check_overdue_orders():
    """æ¯å¤©æª¢æŸ¥é€¾æœŸè¨‚å–®ä¸¦ç™¼é€é€šçŸ¥"""
    today = datetime.now().date()
    
    # æŸ¥è©¢æ‰€æœ‰ç”¢å“
    products = Product.query.filter_by(is_completed=False).all()
    
    for product in products:
        days = (today - product.status_updated_at.date()).days
        
        # è¶…é 3 å¤©æœªæ›´æ–° â†’ é»ƒç‡ˆ â†’ ç™¼é€šçŸ¥
        if days >= 3 and days < 7:
            send_notification(
                user_ids=[product.handler_id],
                notification_type='overdue_alert',
                title='è¨‚å–®é€¾æœŸæé†’',
                message=f'è¨‚å–® #{product.order_number} å·²é€¾æœŸ {days} å¤©ï¼Œè«‹æ³¨æ„è™•ç†',
                order_number=product.order_number,
                product_id=product.id
            )
        
        # è¶…é 7 å¤©æœªæ›´æ–° â†’ ç´…ç‡ˆ â†’ ç™¼é€šçŸ¥çµ¦ä¸»ç®¡å’Œè² è²¬äºº
        elif days >= 7:
            # é€šçŸ¥è² è²¬äºº
            send_notification(
                user_ids=[product.handler_id],
                notification_type='overdue_alert',
                title='è¨‚å–®åš´é‡é€¾æœŸ',
                message=f'è¨‚å–® #{product.order_number} å·²é€¾æœŸ {days} å¤©ï¼Œè«‹ç›¡å¿«è™•ç†',
                order_number=product.order_number,
                product_id=product.id
            )
            
            # é€šçŸ¥ä¸»ç®¡
            admin_ids = [u.id for u in User.query.filter_by(role='admin', is_active=True).all()]
            send_notification(
                user_ids=admin_ids,
                notification_type='overdue_alert',
                title='è¨‚å–®åš´é‡é€¾æœŸ',
                message=f'è¨‚å–® #{product.order_number} å·²é€¾æœŸ {days} å¤©ï¼ˆè² è²¬äººï¼š{product.handler.real_name}ï¼‰',
                order_number=product.order_number,
                product_id=product.id
            )

# å•Ÿå‹•å®šæ™‚ä»»å‹™ï¼ˆæ¯å¤©æ—©ä¸Š 8:00 åŸ·è¡Œï¼‰
scheduler = BackgroundScheduler()
scheduler.add_job(check_overdue_orders, 'cron', hour=8, minute=0)
scheduler.start()
```

---

### éšæ®µå››ï¼šå³å´æŠ½å±œèˆ‡åœ–ç‰‡ç®¡ç† UI

#### 4.1 UI æ¶æ§‹è¨­è¨ˆ

##### æ•´é«”å¸ƒå±€æ–¹æ¡ˆï¼šæ··åˆæ¨¡å¼ï¼ˆæ¨è–¦ï¼‰

```
æ­£å¸¸æ¨¡å¼ï¼ˆè¨‚å–®è©³æƒ…ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚                  â”‚
â”‚  ä¸»è¡¨æ ¼ï¼ˆå…¨å±ï¼‰      â”‚  å³å´æŠ½å±œ         â”‚
â”‚                     â”‚                  â”‚
â”‚  [è¨‚å–®åˆ—è¡¨]          â”‚  [è¨‚å–®è©³æƒ…] âœ“    â”‚
â”‚   âœ“ #KC0001         â”‚  [åœ–ç‰‡ç®¡ç†]      â”‚
â”‚     #00012345       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚     #00012346       â”‚                  â”‚
â”‚                     â”‚  è¨‚å–®ä¿¡æ¯         â”‚
â”‚                     â”‚  ç‹€æ…‹             â”‚
â”‚                     â”‚  é€²åº¦æ¢           â”‚
â”‚                     â”‚  æ™‚é–“è»¸           â”‚
â”‚                     â”‚  å‚™è¨»             â”‚
â”‚                     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é»æ“Šã€Œåœ–ç‰‡ç®¡ç†ã€Tab å¾Œï¼ˆåœ–ç‰‡æ¨¡å¼ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚          â”‚          â”‚          â”‚
â”‚ ä¸»è¡¨æ ¼       â”‚ å·¦ï¼šåŠŸèƒ½å€â”‚ ä¸­ï¼šå¤§åœ–  â”‚ å³ï¼šè©³æƒ…  â”‚
â”‚ (éš±è—)       â”‚          â”‚          â”‚          â”‚
â”‚              â”‚ ğŸ”½è¨‚å–®åˆ‡æ›â”‚          â”‚[è¨‚å–®è©³æƒ…]â”‚
â”‚              â”‚ #KC0001  â”‚          â”‚[åœ–ç‰‡ç®¡ç†]â”‚
â”‚              â”‚ â—€  1/5  â–¶â”‚  [å¤§åœ–]  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚          â”‚
â”‚              â”‚ ğŸ“¦ä¸»è¨‚å–®  â”‚          â”‚ è¨‚å–®ä¿¡æ¯  â”‚
â”‚              â”‚ ğŸ“¦ç”¢å“1  â”‚  [ç¸®åœ–]  â”‚ ç‹€æ…‹     â”‚
â”‚              â”‚ ğŸ“¦ç”¢å“2  â”‚          â”‚ é€²åº¦     â”‚
â”‚              â”‚ ğŸ“¦ç”¢å“3  â”‚          â”‚          â”‚
â”‚              â”‚          â”‚          â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹é»ï¼š**
1. é»˜èªå³å´æŠ½å±œåªæœ‰è¨‚å–®è©³æƒ…
2. é»æ“Šã€Œåœ–ç‰‡ç®¡ç†ã€Tab â†’ è®Šæˆä¸‰æ¬„å¸ƒå±€
3. ä¸»è¡¨æ ¼å®Œå…¨éš±è—ï¼Œå°ˆæ³¨åœ–ç‰‡æŸ¥çœ‹
4. å·¦å´åŠŸèƒ½å€åŒ…å«è¨‚å–®åˆ‡æ›å’Œç”¢å“/æ–‡ä»¶åˆ—è¡¨
5. é»æ“Šã€Œè¨‚å–®è©³æƒ…ã€Tab æˆ–é—œé–‰æŒ‰éˆ• â†’ å›åˆ°æ­£å¸¸æ¨¡å¼

#### 4.2 è¨‚å–®å°èˆªèˆ‡é›™æ¨¡å¼åˆ‡æ›

##### 4.2.1 ç¯©é¸æ¨¡å¼ï¼ˆé»˜èªï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ è¨‚å–®å°èˆª                      â”‚
â”‚                                 â”‚
â”‚ âš¡ ç¯©é¸æ¨¡å¼ â–¼                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ #KC0001 ç«‹ç…§å“©               â”‚ â”‚
â”‚ â”‚ â—€   1/5   â–¶                 â”‚ â”‚
â”‚ â”‚                             â”‚ â”‚
â”‚ â”‚ ç•¶å‰ç¯©é¸ï¼š                   â”‚ â”‚
â”‚ â”‚ [ğŸ”´ ç´…ç‡ˆ âœ•] [ğŸ“‹ åœ–ç¨¿éšæ®µ âœ•] â”‚ â”‚
â”‚ â”‚                             â”‚ â”‚
â”‚ â”‚ ğŸ” åœ¨é€™5ç­†ä¸­æœå°‹...          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ [ğŸŒ åˆ‡æ›åˆ°å…¨å±€æ¨¡å¼ (50ç­†)]       â”‚
â”‚                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒé‚è¼¯ï¼š**
- ç¹¼æ‰¿ä¸»è¡¨æ ¼çš„ç¯©é¸æ¢ä»¶ï¼ˆç´…ç‡ˆã€é»ƒç‡ˆã€ç¶ ç‡ˆã€éšæ®µç­‰ï¼‰
- åªèƒ½åˆ‡æ›ç¬¦åˆç¯©é¸æ¢ä»¶çš„è¨‚å–®
- é¡¯ç¤ºç•¶å‰ä½ç½® (1/5) - è¡¨ç¤ºç¯©é¸çµæœä¸­çš„ç¬¬1å€‹ï¼Œå…±5å€‹
- å¯ä»¥ä¿®æ”¹æˆ–æ¸…é™¤ç¯©é¸æ¢ä»¶
- é¿å…ã€Œè¡¨æ ¼ç¯©é¸ vs æŠ½å±œåˆ‡æ›ã€çš„çŸ›ç›¾

##### 4.2.2 å…¨å±€æ¨¡å¼ï¼ˆå¯åˆ‡æ›ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ è¨‚å–®å°èˆª                      â”‚
â”‚                                 â”‚
â”‚ ğŸŒ å…¨å±€æ¨¡å¼ â–¼                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ #KC0001 ç«‹ç…§å“©               â”‚ â”‚
â”‚ â”‚ â—€   23/50   â–¶               â”‚ â”‚
â”‚ â”‚                             â”‚ â”‚
â”‚ â”‚ ğŸ” åœ¨æ‰€æœ‰è¨‚å–®ä¸­æœå°‹...        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ [âš¡ åˆ‡æ›å›ç¯©é¸æ¨¡å¼ (5ç­†)]         â”‚
â”‚                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒé‚è¼¯ï¼š**
- å¯ä»¥åˆ‡æ›æ‰€æœ‰è¨‚å–®ï¼ˆä¸å—ç¯©é¸é™åˆ¶ï¼‰
- é¡¯ç¤ºç•¶å‰ä½ç½® (23/50) - è¡¨ç¤ºå…¨éƒ¨è¨‚å–®ä¸­çš„ç¬¬23å€‹ï¼Œå…±50å€‹
- ä¸€éµåˆ‡æ›å›ç¯©é¸æ¨¡å¼
- è§£æ±ºã€Œåˆ†é å•é¡Œã€- å¾Œç«¯ API è‡ªå‹•è™•ç†è·¨é åˆ‡æ›

#### 4.3 API ç«¯é»è¨­è¨ˆ

##### 4.3.1 è¨‚å–®å°èˆª API

```javascript
// ç²å–ç›¸é„°è¨‚å–®ï¼ˆæ”¯æŒç¯©é¸æ¨¡å¼å’Œå…¨å±€æ¨¡å¼ï¼‰
GET /api/orders/adjacent

åƒæ•¸ï¼š
- current: ç•¶å‰è¨‚å–®è™Ÿï¼ˆä¾‹å¦‚ï¼šKC0001ï¼‰
- mode: 'filter' æˆ– 'global'
- filters: ç¯©é¸æ¢ä»¶ï¼ˆä¾‹å¦‚ï¼šred,draft_stageï¼‰

è¿”å›ï¼š
{
  prev: "#KC0023",           // ä¸Šä¸€å–®è¨‚å–®è™Ÿ
  next: "#KC0005",           // ä¸‹ä¸€å–®è¨‚å–®è™Ÿ
  current_index: 1,          // ç•¶å‰æ˜¯ç¬¬å¹¾å–®
  total: 5,                  // ç¸½å…±å¹¾å–®ï¼ˆæ ¹æ“šæ¨¡å¼ï¼‰
  current: {
    order_number: "#KC0001",
    customer_name: "ç«‹ç…§å“©",
    ...å®Œæ•´è¨‚å–®è³‡æ–™...
  }
}
```

**å·¥ä½œåŸç†ï¼š**
- å‰ç«¯é»æ“Š â–¶ â†’ èª¿ç”¨ API
- å¾Œç«¯æ ¹æ“š `current + mode + filters` â†’ æ‰¾åˆ°ä¸‹ä¸€å–® â†’ è¿”å›è¨‚å–®è™Ÿ
- å‰ç«¯æ‹¿åˆ°è¨‚å–®è™Ÿ â†’ èª¿ç”¨è©³æƒ… API â†’ ç«‹åˆ»é¡¯ç¤º
- ä¸éœ€è¦çŸ¥é“åˆ†é ï¼Œå¾Œç«¯è‡ªå·±è™•ç†

##### 4.3.2 è¨‚å–®å®Œæ•´è³‡æ–™ API

```javascript
// ç²å–è¨‚å–®å®Œæ•´è³‡æ–™ï¼ˆåŒ…å«ä¸»æª”æ¡ˆã€ç”¢å“ã€åœ–ç‰‡ï¼‰
GET /api/orders/{order_number}/full

è¿”å›ï¼š
{
  order: {...è¨‚å–®åŸºæœ¬è³‡æ–™...},
  order_files: [               // ä¸»è¨‚å–®æª”æ¡ˆ
    {
      file_id: "F00001",
      filename: "åˆç´„.pdf",
      uploaded_by: "admin",
      can_delete: false
    },
    ...
  ],
  products: [                  // ç”¢å“åˆ—è¡¨
    {
      product_id: "PR001",
      product_name: "ç´…è‰²æ¯å­",
      handler: "ç‹å°æ˜",
      images: [                // ç”¢å“åœ–ç‰‡
        {
          file_id: "F00010",
          filename: "åœ–ç¨¿v1.jpg",
          thumbnail: "/uploads/.../thumb.jpg",
          full: "/uploads/.../full.jpg",
          can_delete: true
        },
        ...
      ],
      image_count: 5
    },
    ...
  ],
  stats: {
    total_order_files: 3,
    total_products: 3,
    total_images: 13
  }
}
```

#### 4.4 å‰ç«¯äº¤äº’é‚è¼¯

##### 4.4.1 ç‹€æ…‹ç®¡ç†

```javascript
const imageViewState = {
  mode: 'filter',              // 'filter' æˆ– 'global'
  currentOrder: '#KC0001',
  currentSource: 'main',       // 'main' æˆ– 'product_PR001'
  filters: ['red', 'draft_stage'],
  totalInMode: 5,
  currentIndex: 1,
  isImageViewActive: false
};
```

##### 4.4.2 åˆ‡æ›è¨‚å–®

```javascript
async function navigateOrder(direction) {
  // 1. ç²å–ç›¸é„°è¨‚å–®
  const data = await fetch(`/api/orders/adjacent?...`);
  
  // 2. æ›´æ–°ç‹€æ…‹
  imageViewState.currentOrder = data[direction];
  
  // 3. è¼‰å…¥æ–°è¨‚å–®å®Œæ•´è³‡æ–™
  await loadOrderFullData(imageViewState.currentOrder);
  
  // 4. æ›´æ–° UI
  updateUI();
}
```

##### 4.4.3 æ€§èƒ½å„ªåŒ–

```javascript
// é è¼‰å…¥ä¸Šä¸€å–®å’Œä¸‹ä¸€å–®
async function preloadAdjacentOrders() {
  const data = await fetch(`/api/orders/adjacent?...`);
  
  if (data.prev) fetch(`/api/orders/${data.prev}/full`).then(cache);
  if (data.next) fetch(`/api/orders/${data.next}/full`).then(cache);
}
```

#### 4.5 æ¬Šé™æ§åˆ¶

##### ä¸»ç®¡æ¬Šé™
- âœ… æŸ¥çœ‹æ‰€æœ‰è¨‚å–®çš„æ‰€æœ‰ç”¢å“å’Œæª”æ¡ˆ
- âœ… ä¸Šå‚³/åˆªé™¤ä»»ä½•æª”æ¡ˆ
- âœ… åˆ‡æ›åˆ°ä»»ä½•è¨‚å–®ï¼ˆç¯©é¸æ¨¡å¼ + å…¨å±€æ¨¡å¼ï¼‰

##### æ¥­å‹™å“¡æ¬Šé™
- âœ… æŸ¥çœ‹æœ‰è‡ªå·±ç”¢å“çš„è¨‚å–®
- âœ… æŸ¥çœ‹ä¸»è¨‚å–®æª”æ¡ˆï¼ˆåªè®€ï¼‰
- âœ… ä¸Šå‚³/åˆªé™¤è‡ªå·±ç”¢å“çš„æª”æ¡ˆ
- âŒ çœ‹ä¸åˆ°å…¶ä»–æ¥­å‹™å“¡çš„ç”¢å“

#### 4.6 åœ–ç‰‡é è¦½å¢å¼·åŠŸèƒ½

##### åŠŸèƒ½æ¦‚è¿°
åœ¨åœ–ç‰‡æ¨¡å¼ä¸‹æä¾›æ›´å¥½çš„åœ–ç‰‡æŸ¥çœ‹é«”é©—ï¼ŒåŒ…æ‹¬æ—‹è½‰ã€ç¸®æ”¾ã€å…¨è¢å¹•ç­‰åŠŸèƒ½ã€‚

##### 4.6.1 åœ–ç‰‡æ“ä½œæ§åˆ¶æ¬„

```
ä¸­é–“å¤§åœ–å€åŸŸé ‚éƒ¨ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç•¶å‰ï¼šä¸»è¨‚å–®æª”æ¡ˆ - åˆç´„.pdf       [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [é©æ‡‰è¦–çª—] [100%] [æ”¾å¤§] [ç¸®å°]        â”‚
â”‚ [â†º é€†æ™‚é‡] [â†» é †æ™‚é‡] [â›¶ å…¨è¢å¹•]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 4.6.2 åŠŸèƒ½èªªæ˜

- **ç¸®æ”¾**ï¼šé©æ‡‰è¦–çª—ã€100%ã€æ”¾å¤§ã€ç¸®å°
- **æ—‹è½‰**ï¼šé †æ™‚é‡/é€†æ™‚é‡æ—‹è½‰ 90åº¦
- **å…¨è¢å¹•**ï¼šé€²å…¥/é€€å‡ºå…¨è¢å¹•æ¨¡å¼
- **æ»‘é¼ æ»¾è¼ª**ï¼šCtrl + æ»¾è¼ªç¸®æ”¾
- **æ‹–æ‹½ç§»å‹•**ï¼šæ”¾å¤§å¾Œå¯ä»¥æ‹–æ‹½ç§»å‹•åœ–ç‰‡
- **PDF é è¦½**ï¼šé¡¯ç¤º PDF ç¬¬ä¸€é ç¸®ç•¥åœ–
- **éµç›¤å¿«æ·éµ**ï¼š
  - `+` / `-` : æ”¾å¤§/ç¸®å°
  - `0` : 100%
  - `F` : å…¨è¢å¹•
  - `R` : æ—‹è½‰

#### 4.7 æ‰¹é‡åˆªé™¤æª”æ¡ˆåŠŸèƒ½

##### åŠŸèƒ½æ¦‚è¿°
å…è¨±ç”¨æˆ¶å‹¾é¸å¤šå€‹æª”æ¡ˆä¸¦ä¸€æ¬¡æ€§åˆªé™¤ï¼Œæé«˜æ“ä½œæ•ˆç‡ã€‚

##### 4.7.1 ç•Œé¢è¨­è¨ˆ

```
ç¸®åœ–åˆ—è¡¨æ·»åŠ å‹¾é¸æ¡†ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ ] å…¨é¸  [åˆªé™¤é¸ä¸­ (3)]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â˜‘] ğŸ“„   [â˜‘] ğŸ“Š   [ ] ğŸ“‹   [â˜‘] ğŸ–¼    â”‚
â”‚    åˆç´„      å ±åƒ¹      è¦æ ¼     v1      â”‚
â”‚                                        â”‚
â”‚ â†‘ å‹¾é¸ 3 å€‹æª”æ¡ˆå¾Œï¼Œã€Œåˆªé™¤é¸ä¸­ã€æŒ‰éˆ•å•Ÿç”¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é»æ“Šã€Œåˆªé™¤é¸ä¸­ã€å¾Œå½ˆå‡ºç¢ºèªæ¡†ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¢ºèªåˆªé™¤                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¢ºå®šè¦åˆªé™¤é€™ 3 å€‹æª”æ¡ˆå—ï¼Ÿ   â”‚
â”‚                            â”‚
â”‚ â€¢ åˆç´„.pdf                 â”‚
â”‚ â€¢ å ±åƒ¹å–®.xlsx              â”‚
â”‚ â€¢ åœ–ç¨¿v1.jpg               â”‚
â”‚                            â”‚
â”‚ âš ï¸ æ­¤æ“ä½œç„¡æ³•å¾©åŸ            â”‚
â”‚                            â”‚
â”‚      [å–æ¶ˆ]    [ç¢ºèªåˆªé™¤]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 4.7.2 API è¨­è¨ˆ

```javascript
// æ‰¹é‡åˆªé™¤æª”æ¡ˆ
POST /api/files/batch-delete

æ¬Šé™ï¼šç™»å…¥ç”¨æˆ¶

è«‹æ±‚æ•¸æ“šï¼š
{
  "file_ids": ["F00001", "F00002", "F00005"]
}

è¿”å›æ•¸æ“šï¼š
{
  "success": true,
  "data": {
    "deleted_count": 3,
    "failed": [],           // åˆªé™¤å¤±æ•—çš„æª”æ¡ˆID
    "permission_denied": [] // æ²’æœ‰æ¬Šé™åˆªé™¤çš„æª”æ¡ˆID
  }
}

é‚è¼¯ï¼š
1. æª¢æŸ¥æ¯å€‹æª”æ¡ˆçš„æ¬Šé™
   - æ¥­å‹™å“¡åªèƒ½åˆªè‡ªå·±ä¸Šå‚³çš„
   - ä¸»ç®¡å¯ä»¥åˆªä»»ä½•æª”æ¡ˆ
2. ç¬¦åˆæ¬Šé™çš„æ‰åˆªé™¤ï¼ˆè»Ÿåˆªé™¤ï¼‰
3. è¨˜éŒ„æ“ä½œæ—¥èªŒï¼ˆå¦‚æœåˆªé™¤æ•¸é‡ > 5ï¼‰
4. è¿”å›åˆªé™¤çµæœ
```

---

### éšæ®µäº”ï¼šå‰ç«¯ç•Œé¢æ”¹é€ ï¼ˆå…¶ä»–é é¢ï¼‰

#### 5.1 è¨‚å–®åˆ—è¡¨é 
```
éœ€è¦èª¿æ•´ï¼š
- [ ] é¡¯ç¤ºè¨‚å–®çš„ç”¢å“æ•¸é‡
- [ ] æ¥­å‹™å“¡åªçœ‹åˆ°æœ‰è‡ªå·±è² è²¬ç”¢å“çš„è¨‚å–®
- [ ] ä¸»ç®¡çœ‹åˆ°æ‰€æœ‰è¨‚å–®

è¨‚å–®å¡ç‰‡é¡¯ç¤ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KC0001 - ABCå…¬å¸                     â”‚
â”‚ è¨‚å–®æ—¥æœŸï¼š2026-01-15                 â”‚
â”‚ ç”¢å“æ•¸ï¼š3å€‹                          â”‚
â”‚ æˆ‘è² è²¬ï¼š2å€‹ç”¢å“ï¼ˆæ¥­å‹™å“¡è¦–è§’ï¼‰        â”‚
â”‚ [æŸ¥çœ‹è©³æƒ…]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2 è¨‚å–®è©³æƒ…é 
```
éœ€è¦å…¨æ–°è¨­è¨ˆï¼š

é é¢çµæ§‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¨‚å–® KC0001 - ABCå…¬å¸                â”‚
â”‚ è¨‚å–®æ—¥æœŸï¼š2026-01-15                 â”‚
â”‚                                      â”‚
â”‚ ã€ä¸»ç®¡å°ˆç”¨ã€‘[+ æ–°å¢ç”¢å“]             â”‚
â”‚                                      â”‚
â”‚ === ç”¢å“åˆ—è¡¨ ===                     â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€ ç”¢å“1ï¼šç´…è‰²æ¯å­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ç”¢å“ç·¨è™Ÿï¼šPR001                 â”‚   â”‚
â”‚ â”‚ è² è²¬äººï¼šç‹å°æ˜                   â”‚   â”‚
â”‚ â”‚ ç‹€æ…‹ï¼šåœ–ç¨¿ç¢ºèªä¸­ï¼ˆç­‰å¾…3å¤©ï¼‰      â”‚   â”‚
â”‚ â”‚ æª”æ¡ˆï¼š5å¼µ                        â”‚   â”‚
â”‚ â”‚ [æŸ¥çœ‹è©³æƒ…] [ä¸Šå‚³æª”æ¡ˆ]            â”‚   â”‚
â”‚ â”‚ ã€ä¸»ç®¡å°ˆç”¨ã€‘[è½‰ç§»è² è²¬äºº]         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€ ç”¢å“2ï¼šè—è‰²ç›¤å­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ç”¢å“ç·¨è™Ÿï¼šPR002                 â”‚   â”‚
â”‚ â”‚ è² è²¬äººï¼šå¼µå°è¯                   â”‚   â”‚
â”‚ â”‚ ç‹€æ…‹ï¼šæ‰“æ¨£ä¸­ï¼ˆç­‰å¾…7å¤©ï¼‰          â”‚   â”‚
â”‚ â”‚ æª”æ¡ˆï¼š3å¼µ                        â”‚   â”‚
â”‚ â”‚ [æŸ¥çœ‹è©³æƒ…]                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¥­å‹™å“¡è¦–è§’ï¼š
- åªçœ‹åˆ°è‡ªå·±è² è²¬çš„ç”¢å“
- çœ‹ä¸åˆ°ã€Œæ–°å¢ç”¢å“ã€æŒ‰éˆ•
- çœ‹ä¸åˆ°ã€Œè½‰ç§»è² è²¬äººã€æŒ‰éˆ•
```

#### 4.3 ç”¢å“è©³æƒ…é ï¼ˆæ–°å¢ï¼‰
```
é é¢è·¯å¾‘ï¼š/tracking/products/{product_id}

é é¢å…§å®¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¢å“è©³æƒ… - ç´…è‰²æ¯å­                  â”‚
â”‚ æ‰€å±¬è¨‚å–®ï¼šKC0001 - ABCå…¬å¸           â”‚
â”‚                                      â”‚
â”‚ === åŸºæœ¬ä¿¡æ¯ ===                     â”‚
â”‚ ç”¢å“ç·¨è™Ÿï¼šP-RED-CUP                  â”‚
â”‚ æ•¸é‡ï¼š500å€‹                          â”‚
â”‚ å·¥å» ï¼šAå·¥å»                           â”‚
â”‚ è² è²¬äººï¼šç‹å°æ˜                       â”‚
â”‚ å‰µå»ºè€…ï¼šç‹å°æ˜                       â”‚
â”‚ ç•¶å‰ç‹€æ…‹ï¼šåœ–ç¨¿ç¢ºèªä¸­ï¼ˆç­‰å¾…3å¤©ï¼‰ğŸŸ¡    â”‚
â”‚                                      â”‚
â”‚ === ç‹€æ…‹æ“ä½œ ===                     â”‚
â”‚ [æ›´æ–°ç‹€æ…‹] [æ·»åŠ å‚™è¨»]                â”‚
â”‚                                      â”‚
â”‚ === æª”æ¡ˆåˆ—è¡¨ ===                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“„ drawing_v1.jpg                â”‚   â”‚
â”‚ â”‚ ç‹å°æ˜ä¸Šå‚³ï¼Œ2026-01-15 10:30     â”‚   â”‚
â”‚ â”‚ [ä¸‹è¼‰] [åˆªé™¤]                    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“„ drawing_v2.jpg                â”‚   â”‚
â”‚ â”‚ ç‹å°æ˜ä¸Šå‚³ï¼Œ2026-01-16 14:20     â”‚   â”‚
â”‚ â”‚ [ä¸‹è¼‰] [åˆªé™¤]                    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“„ quotation.pdf                 â”‚   â”‚
â”‚ â”‚ å¼µå°è¯ä¸Šå‚³ï¼Œ2026-01-17 09:15     â”‚   â”‚
â”‚ â”‚ [ä¸‹è¼‰] âŒä¸èƒ½åˆªï¼ˆä¸æ˜¯ä½ ä¸Šå‚³çš„ï¼‰   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚ [+ ä¸Šå‚³æ–°æª”æ¡ˆ]                       â”‚
â”‚                                      â”‚
â”‚ === ç‹€æ…‹æ­·å² ===                     â”‚
â”‚ Timelineé¡¯ç¤º...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4 æª”æ¡ˆä¸Šå‚³çµ„ä»¶
```
éœ€è¦å¯¦ç¾ï¼š
- æ‹–æ‹½ä¸Šå‚³
- å¤šæª”æ¡ˆä¸Šå‚³
- ä¸Šå‚³é€²åº¦æ¢
- æª”æ¡ˆé¡å‹æª¢æŸ¥
- æª”æ¡ˆå¤§å°æª¢æŸ¥
- ä¸Šå‚³æˆåŠŸå¾Œè‡ªå‹•åˆ·æ–°æª”æ¡ˆåˆ—è¡¨
```

#### 4.5 ä¸»ç®¡å°ˆç”¨åŠŸèƒ½
```
éœ€è¦æ·»åŠ çš„ç•Œé¢ï¼š

1. ç”¢å“è½‰ç§» Modalï¼š
   - é¸æ“‡æ–°è² è²¬äººï¼ˆä¸‹æ‹‰é¸å–®ï¼Œåˆ—å‡ºæ‰€æœ‰æ¥­å‹™å“¡ï¼‰
   - å¡«å¯«è½‰ç§»åŸå› ï¼ˆå¯é¸ï¼‰
   - ç¢ºèªæŒ‰éˆ•

2. æ–°å¢ç”¢å“ Modalï¼š
   - ç”¢å“åç¨±ã€ç·¨è™Ÿã€æ•¸é‡ç­‰
   - é¸æ“‡è² è²¬äºº
   - ç¢ºèªæŒ‰éˆ•
```

### éšæ®µäº”ï¼šæ¬Šé™æ§åˆ¶èˆ‡å®‰å…¨

#### 5.1 å¾Œç«¯æ¬Šé™æª¢æŸ¥
```
éœ€è¦å¯¦ç¾çš„è£é£¾å™¨ï¼š

@login_required
def some_function():
    # å¿…é ˆç™»å…¥æ‰èƒ½è¨ªå•
    pass

@admin_required
def admin_only_function():
    # åƒ…ä¸»ç®¡å¯ä»¥è¨ªå•
    pass

@product_permission_required(product_id)
def product_function(product_id):
    # æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰æ¬Šé™æ“ä½œé€™å€‹ç”¢å“
    # ä¸»ç®¡ï¼šæ‰€æœ‰ç”¢å“
    # æ¥­å‹™å“¡ï¼šè‡ªå·±è² è²¬çš„ç”¢å“
    pass
```

#### 5.2 å‰ç«¯æ¬Šé™é¡¯ç¤º
```
æ ¹æ“šç”¨æˆ¶è§’è‰²é¡¯ç¤º/éš±è—åŠŸèƒ½ï¼š

{% if session.get('role') == 'admin' %}
    <!-- ä¸»ç®¡å°ˆç”¨æŒ‰éˆ• -->
    <button onclick="openNewProductModal()">æ–°å¢ç”¢å“</button>
    <button onclick="transferProduct()">è½‰ç§»è² è²¬äºº</button>
{% endif %}

JavaScript ä¸­ä¹Ÿè¦æª¢æŸ¥ï¼š
if (userRole === 'admin') {
    // é¡¯ç¤ºä¸»ç®¡åŠŸèƒ½
}
```

#### 5.3 API å®‰å…¨æª¢æŸ¥
```
æ¯å€‹ API ç«¯é»éƒ½è¦ï¼š
1. é©—è­‰ç”¨æˆ¶ç™»å…¥
2. é©—è­‰ç”¨æˆ¶è§’è‰²
3. é©—è­‰æ“ä½œæ¬Šé™
4. é©—è­‰æ•¸æ“šå®Œæ•´æ€§

æ‹’çµ•è¨ªå•æ™‚è¿”å›ï¼š
{
  "success": false,
  "error": "æ¬Šé™ä¸è¶³",
  "code": 403
}
```

---

## AI å¯¦ç¾æŒ‡å¼•

### çµ¦ AI çš„åˆ†éšæ®µä»»å‹™æŒ‡ä»¤

#### éšæ®µä¸€ï¼šæ•¸æ“šçµæ§‹æ”¹é€ 

```markdown
è«‹å¹«æˆ‘å¯¦ç¾è¨‚å–®ç³»çµ±çš„æ•¸æ“šçµæ§‹æ”¹é€ ï¼š

**èƒŒæ™¯ï¼š**
ç›®å‰ç³»çµ±æ˜¯ä¸€å¼µè¨‚å–®ç›´æ¥è¨˜éŒ„ç”¢å“ä¿¡æ¯ï¼Œéœ€è¦æ”¹ç‚ºã€Œè¨‚å–® â†’ ç”¢å“ã€çš„å…©å±¤çµæ§‹ã€‚

**éœ€æ±‚ï¼š**
1. å‰µå»º `Product` æ¨¡å‹ï¼ŒåŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š
   - idï¼ˆç”¢å“IDï¼Œè‡ªå‹•ç”Ÿæˆï¼Œä¾‹å¦‚PR001ï¼‰
   - order_numberï¼ˆæ‰€å±¬è¨‚å–®è™Ÿï¼‰
   - product_nameï¼ˆç”¢å“åç¨±ï¼‰
   - product_codeï¼ˆç”¢å“ç·¨è™Ÿï¼‰
   - quantityï¼ˆæ•¸é‡ï¼‰
   - factoryï¼ˆå·¥å» ï¼‰
   - production_typeï¼ˆç”Ÿç”¢é¡å‹ï¼‰
   - expected_delivery_dateï¼ˆé è¨ˆäº¤è²¨æ—¥æœŸï¼‰
   - current_statusï¼ˆç•¶å‰ç‹€æ…‹ï¼‰
   - status_updated_atï¼ˆç‹€æ…‹æ›´æ–°æ™‚é–“ï¼‰
   - created_by_idï¼ˆå‰µå»ºè€…IDï¼‰
   - handler_idï¼ˆç•¶å‰è² è²¬äººIDï¼‰
   - folder_pathï¼ˆè³‡æ–™å¤¾è·¯å¾‘ï¼‰
   - notesï¼ˆå‚™è¨»ï¼‰
   - created_at, updated_at

2. å‰µå»º `File` æ¨¡å‹ï¼ŒåŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š
   - idï¼ˆæª”æ¡ˆIDï¼‰
   - order_numberï¼ˆè¨‚å–®è™Ÿï¼‰
   - product_idï¼ˆç”¢å“IDï¼‰
   - filenameï¼ˆæª”åï¼‰
   - file_pathï¼ˆæª”æ¡ˆè·¯å¾‘ï¼‰
   - file_sizeï¼ˆæª”æ¡ˆå¤§å°ï¼‰
   - file_typeï¼ˆæª”æ¡ˆé¡å‹ï¼‰
   - uploaded_by_idï¼ˆä¸Šå‚³è€…IDï¼‰
   - uploaded_atï¼ˆä¸Šå‚³æ™‚é–“ï¼‰
   - is_deletedï¼ˆæ˜¯å¦å·²åˆªé™¤ï¼‰
   - deleted_by_id, deleted_at

3. å‰µå»º `ProductStatusHistory` æ¨¡å‹ï¼ˆå¾ OrderStatusHistory æ”¹åï¼‰

4. å‰µå»º `ProductHandoverLog` æ¨¡å‹ï¼ˆç”¢å“è½‰ç§»è¨˜éŒ„ï¼‰

5. èª¿æ•´ `User` æ¨¡å‹ï¼Œæ·»åŠ ï¼š
   - real_nameï¼ˆçœŸå¯¦å§“åï¼‰
   - roleï¼ˆè§’è‰²ï¼šadmin æˆ– staffï¼‰

6. èª¿æ•´ `Order` æ¨¡å‹ï¼Œç§»é™¤ç”¢å“ç›¸é—œæ¬„ä½ï¼Œæ·»åŠ ï¼š
   - created_by_idï¼ˆå‰µå»ºè€…IDï¼‰

7. ç·¨å¯«æ•¸æ“šåº«é·ç§»è…³æœ¬

**è«‹æä¾›å®Œæ•´çš„ models.py ä»£ç¢¼å’Œé·ç§»é‚è¼¯ã€‚**
```

#### éšæ®µäºŒï¼šç”¢å“ç®¡ç† API

```markdown
è«‹å¯¦ç¾ç”¢å“ç®¡ç†çš„ API ç«¯é»ï¼š

**éœ€è¦å¯¦ç¾çš„åŠŸèƒ½ï¼š**

1. **å‰µå»ºç”¢å“**
   - ç«¯é»ï¼šPOST /tracking/api/orders/{order_number}/products
   - æ¬Šé™ï¼šç™»å…¥ç”¨æˆ¶
   - é‚è¼¯ï¼š
     * ç”Ÿæˆç”¢å“IDï¼ˆPR001, PR002...ï¼‰
     * handler_id = ç•¶å‰ç”¨æˆ¶ID
     * å‰µå»ºè³‡æ–™å¤¾ /uploads/{order_number}/{product_id}/
     * åˆå§‹åŒ–ç‹€æ…‹ç‚ºã€Œæ–°è¨‚å–®ã€
   - è¿”å›ç”¢å“ä¿¡æ¯

2. **æŸ¥è©¢ç”¢å“åˆ—è¡¨**
   - ç«¯é»ï¼šGET /tracking/api/orders/{order_number}/products
   - æ¬Šé™é‚è¼¯ï¼š
     * adminï¼šçœ‹æ‰€æœ‰ç”¢å“
     * staffï¼šåªçœ‹ handler_id = ç•¶å‰ç”¨æˆ¶ID çš„ç”¢å“
   - è¿”å›ç”¢å“åˆ—è¡¨ï¼ˆåŒ…å«æª”æ¡ˆæ•¸é‡ï¼‰

3. **æŸ¥è©¢ç”¢å“è©³æƒ…**
   - ç«¯é»ï¼šGET /tracking/api/products/{product_id}
   - è¿”å›å®Œæ•´ç”¢å“ä¿¡æ¯å’Œæª”æ¡ˆåˆ—è¡¨

4. **æ›´æ–°ç”¢å“ç‹€æ…‹**
   - ç«¯é»ï¼šPUT /tracking/api/products/{product_id}/status
   - æ¬Šé™ï¼šç”¢å“è² è²¬äººæˆ–ä¸»ç®¡
   - è¨˜éŒ„åˆ° product_status_history

5. **ç”¢å“è½‰ç§»ï¼ˆä¸»ç®¡å°ˆç”¨ï¼‰**
   - ç«¯é»ï¼šPOST /tracking/api/products/{product_id}/transfer
   - æ¬Šé™ï¼šåƒ… admin
   - æ›´æ–° handler_id
   - è¨˜éŒ„åˆ° product_handover_log

**è«‹æä¾›å®Œæ•´çš„ API å¯¦ç¾ä»£ç¢¼ï¼ˆFlask Blueprintï¼‰ã€‚**
```

#### éšæ®µä¸‰ï¼šæª”æ¡ˆä¸Šå‚³åŠŸèƒ½

```markdown
è«‹å¯¦ç¾æª”æ¡ˆä¸Šå‚³å’Œç®¡ç†åŠŸèƒ½ï¼š

**éœ€è¦å¯¦ç¾ï¼š**

1. **æª”æ¡ˆä¸Šå‚³**
   - ç«¯é»ï¼šPOST /tracking/api/products/{product_id}/files
   - æ”¯æŒï¼šmultipart/form-data
   - æ¬Šé™æª¢æŸ¥ï¼šç”¢å“çš„ handler æˆ– admin
   - æª”æ¡ˆé©—è­‰ï¼š
     * æª”æ¡ˆå¤§å° < 10MB
     * æª”æ¡ˆé¡å‹ï¼šåœ–ç‰‡ã€PDFã€Excelã€Word
   - ä¿å­˜é‚è¼¯ï¼š
     * è®€å–ç”¢å“çš„ folder_path
     * ä¿å­˜åˆ° {folder_path}/{åŸå§‹æª”å}
     * è¨˜éŒ„åˆ° files è¡¨
   - è¿”å›æª”æ¡ˆä¿¡æ¯

2. **æª”æ¡ˆåˆ—è¡¨æŸ¥è©¢**
   - ç«¯é»ï¼šGET /tracking/api/products/{product_id}/files
   - è¿”å›æª”æ¡ˆåˆ—è¡¨
   - æ¨™è¨˜ can_deleteï¼ˆåˆ¤æ–·æ˜¯å¦å¯åˆªé™¤ï¼‰

3. **æª”æ¡ˆä¸‹è¼‰**
   - ç«¯é»ï¼šGET /tracking/api/files/{file_id}/download
   - æ¬Šé™æª¢æŸ¥
   - è¿”å›æª”æ¡ˆæµ

4. **æª”æ¡ˆåˆªé™¤**
   - ç«¯é»ï¼šDELETE /tracking/api/files/{file_id}
   - æ¬Šé™æª¢æŸ¥ï¼š
     * uploaded_by_id = ç•¶å‰ç”¨æˆ¶ID
     * æˆ–è€…æ˜¯ admin
   - è»Ÿåˆªé™¤ï¼šis_deleted = true

**è«‹æä¾›å®Œæ•´çš„æª”æ¡ˆç®¡ç† API ä»£ç¢¼ã€‚**
```

#### éšæ®µå››ï¼šå‰ç«¯ç•Œé¢

```markdown
è«‹å¹«æˆ‘æ”¹é€ å‰ç«¯ç•Œé¢ï¼š

**éœ€è¦æ”¹é€ çš„é é¢ï¼š**

1. **è¨‚å–®è©³æƒ…é ** (order_detail.html)
   - é¡¯ç¤ºç”¢å“åˆ—è¡¨ï¼ˆä¸æ˜¯å–®å€‹ç”¢å“ä¿¡æ¯ï¼‰
   - æ¯å€‹ç”¢å“é¡¯ç¤ºï¼šåç¨±ã€ç‹€æ…‹ã€è² è²¬äººã€æª”æ¡ˆæ•¸
   - ä¸»ç®¡å¯è¦‹ï¼š[æ–°å¢ç”¢å“] [è½‰ç§»è² è²¬äºº] æŒ‰éˆ•
   - æ¥­å‹™å“¡åªçœ‹åˆ°è‡ªå·±è² è²¬çš„ç”¢å“

2. **æ–°å¢ï¼šç”¢å“è©³æƒ…é ** (product_detail.html)
   - é¡¯ç¤ºç”¢å“å®Œæ•´ä¿¡æ¯
   - é¡¯ç¤ºæª”æ¡ˆåˆ—è¡¨
   - æª”æ¡ˆä¸Šå‚³çµ„ä»¶
   - ç‹€æ…‹æ›´æ–°åŠŸèƒ½
   - ç‹€æ…‹æ­·å²æ™‚é–“è»¸

3. **æ–°å¢ï¼šç”¢å“å‰µå»º Modal**
   - è¡¨å–®ï¼šç”¢å“åç¨±ã€ç·¨è™Ÿã€æ•¸é‡ç­‰
   - é¸æ“‡è² è²¬äººï¼ˆä¸‹æ‹‰é¸å–®ï¼‰
   - æäº¤å¾Œèª¿ç”¨ API

4. **æ–°å¢ï¼šç”¢å“è½‰ç§» Modal**
   - é¸æ“‡æ–°è² è²¬äºº
   - å¡«å¯«è½‰ç§»åŸå› 
   - æäº¤å¾Œèª¿ç”¨ API

5. **æª”æ¡ˆä¸Šå‚³çµ„ä»¶**
   - æ‹–æ‹½ä¸Šå‚³
   - å¤šæª”æ¡ˆä¸Šå‚³
   - é€²åº¦æ¢
   - ä¸Šå‚³æˆåŠŸå¾Œåˆ·æ–°åˆ—è¡¨

**è«‹æä¾›å®Œæ•´çš„ HTML å’Œ JavaScript ä»£ç¢¼ã€‚**
```

#### éšæ®µå››ä¹‹äºŒï¼šä¸»ç®¡å°ˆç”¨åŠŸèƒ½

```markdown
è«‹å¯¦ç¾ä¸»ç®¡å°ˆç”¨åŠŸèƒ½ï¼ˆç”¨æˆ¶ç®¡ç†ã€ç”¢å“è½‰ç§»ã€å„€è¡¨æ¿ï¼‰ï¼š

**éœ€è¦å¯¦ç¾çš„åŠŸèƒ½ï¼š**

1. **ç”¨æˆ¶ç®¡ç†ç•Œé¢** (/admin/users)
   - ç”¨æˆ¶åˆ—è¡¨é é¢
     * é¡¯ç¤ºæ‰€æœ‰ç”¨æˆ¶ï¼ˆå¸³è™Ÿã€å§“åã€è§’è‰²ã€ç‹€æ…‹ï¼‰
     * æ¯å€‹ç”¨æˆ¶é¡¯ç¤ºè² è²¬çš„ç”¢å“æ•¸é‡
     * æœå°‹å’Œç¯©é¸åŠŸèƒ½
   - æ–°å¢ç”¨æˆ¶ Modal
     * è¡¨å–®ï¼šå¸³è™Ÿã€å¯†ç¢¼ã€å§“åã€è§’è‰²
     * é©—è­‰å¸³è™Ÿå”¯ä¸€æ€§
   - ç·¨è¼¯ç”¨æˆ¶ Modal
     * ä¿®æ”¹å§“åã€è§’è‰²
     * åœç”¨/å•Ÿç”¨å¸³è™Ÿ
   - é‡è¨­å¯†ç¢¼ Modal
     * è¼¸å…¥æ–°å¯†ç¢¼
     * é¡¯ç¤ºæ–°å¯†ç¢¼çµ¦ä¸»ç®¡

2. **ç”¨æˆ¶ç®¡ç† API**
   - POST /api/admin/users - å‰µå»ºç”¨æˆ¶
   - GET /api/admin/users - æŸ¥è©¢ç”¨æˆ¶åˆ—è¡¨
   - PUT /api/admin/users/{user_id} - æ›´æ–°ç”¨æˆ¶
   - POST /api/admin/users/{user_id}/reset-password - é‡è¨­å¯†ç¢¼
   - POST /api/admin/users/{user_id}/deactivate - åœç”¨å¸³è™Ÿ
   
3. **ç”¢å“è½‰ç§»åŠŸèƒ½**
   - å–®å€‹ç”¢å“è½‰ç§» Modal
     * é¸æ“‡æ–°è² è²¬äººï¼ˆä¸‹æ‹‰é¸å–®ï¼‰
     * å¡«å¯«è½‰ç§»åŸå› 
     * ç¢ºèªæŒ‰éˆ•
   - æ‰¹é‡ç”¢å“è½‰ç§» Modal
     * ç•¶åœç”¨ç”¨æˆ¶æ™‚å½ˆå‡º
     * é¡¯ç¤ºè©²ç”¨æˆ¶æ‰€æœ‰ç”¢å“åˆ—è¡¨
     * é¸æ“‡æ–°è² è²¬äºº
     * ä¸€éµè½‰ç§»æ‰€æœ‰ç”¢å“
   - API ç«¯é»ï¼š
     * POST /api/admin/products/{product_id}/transfer - å–®å€‹è½‰ç§»
     * POST /api/admin/products/batch-transfer - æ‰¹é‡è½‰ç§»
     * GET /api/admin/products/{product_id}/handover-history - è½‰ç§»æ­·å²
     * GET /api/admin/users/{user_id}/handover-history - ç”¨æˆ¶è½‰ç§»è¨˜éŒ„

4. **ä¸»ç®¡å„€è¡¨æ¿** (/admin/dashboard)
   - é¡¯ç¤ºçµ±è¨ˆå¡ç‰‡ï¼š
     * ç¸½è¨‚å–®æ•¸ã€ç¸½ç”¢å“æ•¸ã€ç¸½ç”¨æˆ¶æ•¸ã€ç¸½æª”æ¡ˆæ•¸
   - é¡¯ç¤ºè¨‚å–®ç‹€æ…‹åˆ†å¸ƒï¼ˆç´…é»ƒç¶ ç‡ˆï¼‰
   - é¡¯ç¤ºå„éšæ®µè¨‚å–®åˆ†å¸ƒï¼ˆåœ“é¤…åœ–æˆ–é•·æ¢åœ–ï¼‰
   - é¡¯ç¤ºæ¥­å‹™å“¡å·¥ä½œé‡ï¼š
     * æ¯å€‹æ¥­å‹™å“¡è² è²¬çš„ç”¢å“æ•¸
     * ç´…ç‡ˆã€é»ƒç‡ˆç”¢å“æ•¸
   - é¡¯ç¤ºæœ€è¿‘æ´»å‹•è¨˜éŒ„ï¼ˆæ™‚é–“è»¸ï¼‰
   - API ç«¯é»ï¼š
     * GET /api/admin/dashboard - ç²å–å„€è¡¨æ¿æ•¸æ“š

5. **æ¬Šé™æª¢æŸ¥**
   - å‰µå»º @admin_required è£é£¾å™¨
   - æ‰€æœ‰ä¸»ç®¡åŠŸèƒ½ API éƒ½è¦åŠ ä¸Šæ¬Šé™æª¢æŸ¥
   - å‰ç«¯æ ¹æ“š session['role'] é¡¯ç¤º/éš±è—ä¸»ç®¡åŠŸèƒ½æŒ‰éˆ•
   - æ¥­å‹™å“¡è¨ªå•ä¸»ç®¡é é¢æ™‚é‡å®šå‘æˆ–é¡¯ç¤º 403

**é‚è¼¯é‡é»ï¼š**

ç”¨æˆ¶ç®¡ç†ï¼š
1. å‰µå»ºç”¨æˆ¶æ™‚ï¼Œæª¢æŸ¥å¸³è™Ÿå”¯ä¸€æ€§
2. é‡è¨­å¯†ç¢¼æ™‚ï¼ŒåŠ å¯†å¾Œå­˜å„²
3. åœç”¨ç”¨æˆ¶æ™‚ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰ç”¢å“éœ€è¦è½‰ç§»
4. ä¸èƒ½åˆªé™¤ç”¨æˆ¶ï¼Œåªèƒ½åœç”¨ï¼ˆä¿ç•™æ­·å²è¨˜éŒ„ï¼‰

ç”¢å“è½‰ç§»ï¼š
1. æ›´æ–°ç”¢å“çš„ handler_id
2. è¨˜éŒ„åˆ° product_handover_log è¡¨
3. æª”æ¡ˆè³‡æ–™å¤¾ä¸å‹•
4. æ­·å²è¨˜éŒ„ä¿ç•™åŸæ“ä½œäºº
5. æ–°è² è²¬äººç«‹å³å¯ä»¥è¨ªå•è©²ç”¢å“

å„€è¡¨æ¿ï¼š
1. çµ±è¨ˆæ•¸æ“šéœ€è¦å³æ™‚æŸ¥è©¢
2. è€ƒæ…®ç·©å­˜ä»¥æé«˜æ€§èƒ½ï¼ˆå¯é¸ï¼‰
3. æœ€è¿‘æ´»å‹•é™åˆ¶é¡¯ç¤ºæœ€è¿‘ 20 æ¢

**è«‹æä¾›å®Œæ•´çš„å¯¦ç¾ä»£ç¢¼ï¼ˆAPI + å‰ç«¯ç•Œé¢ï¼‰ã€‚**
```

#### éšæ®µå››ä¹‹ä¸‰ï¼šè¼”åŠ©åŠŸèƒ½ï¼ˆé€šçŸ¥ã€æ—¥èªŒã€åŒ¯å‡ºç­‰ï¼‰

```markdown
è«‹å¯¦ç¾ä»¥ä¸‹è¼”åŠ©åŠŸèƒ½ï¼š

**éœ€è¦å¯¦ç¾çš„åŠŸèƒ½ï¼š**

1. **ç”¨æˆ¶ä¿®æ”¹å¯†ç¢¼**
   - å€‹äººè¨­å®šé é¢æˆ–ä¸‹æ‹‰é¸å–®
   - Modalï¼šè¼¸å…¥åŸå¯†ç¢¼ã€æ–°å¯†ç¢¼ã€ç¢ºèªå¯†ç¢¼
   - APIï¼šPOST /api/user/change-password
   - é©—è­‰åŸå¯†ç¢¼æ­£ç¢ºæ€§
   - å¯†ç¢¼å¼·åº¦æª¢æŸ¥ï¼ˆè‡³å°‘6ä½ï¼‰

2. **æ“ä½œæ—¥èªŒç³»çµ±**
   - è¨˜éŒ„é—œéµæ“ä½œï¼š
     * create_order, create_product, transfer_product
     * create_user, modify_user, reset_password
   - æ“ä½œæ—¥èªŒè¡¨ï¼ˆoperation_logsï¼‰
   - APIï¼šGET /api/admin/logsï¼ˆä¸»ç®¡å°ˆç”¨ï¼‰
   - å‰ç«¯ç•Œé¢ï¼šä¸»ç®¡å„€è¡¨æ¿ä¸­é¡¯ç¤ºæœ€è¿‘æ“ä½œ
   - æ”¯æ´ç¯©é¸ï¼šç”¨æˆ¶ã€æ“ä½œé¡å‹ã€æ—¥æœŸç¯„åœ

3. **é€šçŸ¥ç³»çµ±ï¼ˆç«™å…§é€šçŸ¥ï¼‰**
   - é€šçŸ¥è¡¨ï¼ˆnotificationsï¼‰
   - é€šçŸ¥å ´æ™¯ï¼š
     * å‰µå»ºè¨‚å–® â†’ é€šçŸ¥æ‰€æœ‰æ¥­å‹™å“¡
     * å‰µå»ºç”¢å“ â†’ é€šçŸ¥ä¸»ç®¡
     * è½‰ç§»ç”¢å“ â†’ é€šçŸ¥æ–°èˆŠè² è²¬äºº
     * è¨‚å–®é€¾æœŸ â†’ è‡ªå‹•é€šçŸ¥ï¼ˆå®šæ™‚ä»»å‹™ï¼‰
   - APIï¼š
     * GET /api/notifications - ç²å–é€šçŸ¥åˆ—è¡¨
     * POST /api/notifications/{id}/read - æ¨™è¨˜å·²è®€
     * POST /api/notifications/read-all - å…¨éƒ¨å·²è®€
   - å‰ç«¯ç•Œé¢ï¼š
     * é ‚éƒ¨å°èˆªæ¬„é€šçŸ¥éˆ´éº + æœªè®€æ•¸å­—
     * é»æ“Šå±•é–‹é€šçŸ¥åˆ—è¡¨
     * é€šçŸ¥å¡ç‰‡å¯é»æ“Šè·³è½‰
   - å®šæ™‚ä»»å‹™ï¼šæ¯å¤©æª¢æŸ¥é€¾æœŸè¨‚å–®ä¸¦ç™¼é€é€šçŸ¥

4. **æ•¸æ“šåŒ¯å‡ºåŠŸèƒ½**
   - åŒ¯å‡ºè¨‚å–®åˆ—è¡¨ï¼ˆExcelï¼‰
     * APIï¼šGET /api/admin/export/orders
     * ä½¿ç”¨ openpyxl æˆ–é¡ä¼¼åº«
     * åŒ…å«ï¼šè¨‚å–®è™Ÿã€å®¢æˆ¶ã€æ—¥æœŸã€ç”¢å“æ•¸ã€ç‹€æ…‹ã€å¤©æ•¸
   - åŒ¯å‡ºç”¢å“åˆ—è¡¨ï¼ˆExcelï¼‰
     * APIï¼šGET /api/admin/export/products
     * åŒ…å«ï¼šè¨‚å–®è™Ÿã€ç”¢å“åã€è² è²¬äººã€ç‹€æ…‹ã€æª”æ¡ˆæ•¸
   - æ‰¹é‡ä¸‹è¼‰è¨‚å–®æª”æ¡ˆï¼ˆZIPï¼‰
     * APIï¼šGET /api/orders/{order_number}/download-all
     * ä½¿ç”¨ zipfile æ‰“åŒ…
     * çµæ§‹ï¼šä¸»è¨‚å–®æª”æ¡ˆ/ + ç”¢å“1/ + ç”¢å“2/
   - å‰ç«¯ç•Œé¢ï¼š
     * è¨‚å–®åˆ—è¡¨é ï¼š[åŒ¯å‡º] ä¸‹æ‹‰é¸å–®
     * è¨‚å–®è©³æƒ…é ï¼š[ä¸‹è¼‰å…¨éƒ¨æª”æ¡ˆ] æŒ‰éˆ•

5. **å®¢æˆ¶åç¨±è‡ªå‹•å»ºè­°**
   - APIï¼šGET /api/customers/suggestions
   - å¾ orders è¡¨æå–ä¸é‡è¤‡çš„ customer_name
   - æŒ‰å­—æ¯æ’åºè¿”å›
   - å‰ç«¯ï¼š
     * ä½¿ç”¨ <input list="datalist"> æˆ–è‡ªå‹•å®Œæˆçµ„ä»¶
     * å‰µå»ºè¨‚å–®æ™‚å¯é¸æ“‡æˆ–è¼¸å…¥æ–°å®¢æˆ¶

6. **åœ–ç‰‡é è¦½å¢å¼·**
   - ç¸®æ”¾åŠŸèƒ½ï¼šé©æ‡‰è¦–çª—ã€100%ã€æ”¾å¤§ã€ç¸®å°
   - æ—‹è½‰åŠŸèƒ½ï¼šé †æ™‚é‡ã€é€†æ™‚é‡
   - å…¨è¢å¹•æ¨¡å¼
   - æ»‘é¼ æ»¾è¼ªç¸®æ”¾ï¼ˆCtrl + æ»¾è¼ªï¼‰
   - æ‹–æ‹½ç§»å‹•ï¼ˆæ”¾å¤§å¾Œï¼‰
   - PDF é è¦½ï¼ˆä½¿ç”¨ PDF.js é¡¯ç¤ºç¬¬ä¸€é ï¼‰
   - éµç›¤å¿«æ·éµï¼š+/- ç¸®æ”¾ã€F å…¨è¢å¹•ã€R æ—‹è½‰

7. **æ‰¹é‡åˆªé™¤æª”æ¡ˆ**
   - ç¸®åœ–åˆ—è¡¨æ·»åŠ å‹¾é¸æ¡†
   - [å…¨é¸] [åˆªé™¤é¸ä¸­] æŒ‰éˆ•
   - APIï¼šPOST /api/files/batch-delete
   - æ¬Šé™æª¢æŸ¥ï¼šæ¥­å‹™å“¡åªèƒ½åˆªè‡ªå·±çš„ï¼Œä¸»ç®¡å¯åˆªä»»ä½•
   - è¿”å›ï¼šæˆåŠŸæ•¸ã€å¤±æ•—æ•¸ã€æ¬Šé™ä¸è¶³æ•¸
   - ç¢ºèªå°è©±æ¡†æç¤º

**é‡é»æé†’ï¼š**

é€šçŸ¥ç³»çµ±ï¼š
- ä½¿ç”¨å¾Œç«¯å‡½æ•¸ send_notification() çµ±ä¸€ç™¼é€
- åœ¨ç›¸é—œ API ä¸­èª¿ç”¨ï¼ˆå‰µå»ºè¨‚å–®ã€è½‰ç§»ç”¢å“ç­‰ï¼‰
- å®šæ™‚ä»»å‹™éœ€è¦ä½¿ç”¨ APScheduler æˆ–é¡ä¼¼å·¥å…·

æ“ä½œæ—¥èªŒï¼š
- ä½¿ç”¨ log_operation() å‡½æ•¸è¨˜éŒ„
- åªè¨˜éŒ„é—œéµæ“ä½œï¼Œä¸è¨˜éŒ„æŸ¥è©¢æ“ä½œ
- è¨˜éŒ„è©³ç´°ä¿¡æ¯ï¼ˆJSON æ ¼å¼ï¼‰

æ•¸æ“šåŒ¯å‡ºï¼š
- ä½¿ç”¨ openpyxl ç”Ÿæˆ Excel
- ä½¿ç”¨ zipfile æ‰“åŒ…æª”æ¡ˆ
- è¿”å›æª”æ¡ˆæµï¼ˆBytesIOï¼‰

**è«‹æä¾›å®Œæ•´çš„å¯¦ç¾ä»£ç¢¼ï¼ˆAPI + å‰ç«¯ç•Œé¢ + å®šæ™‚ä»»å‹™ï¼‰ã€‚**
```

#### éšæ®µäº”ï¼šæ¬Šé™æ§åˆ¶

```markdown
è«‹å¯¦ç¾å®Œæ•´çš„æ¬Šé™æ§åˆ¶ç³»çµ±ï¼š

**éœ€è¦å¯¦ç¾ï¼š**

1. **å¾Œç«¯æ¬Šé™è£é£¾å™¨**
   ```python
   @login_required
   @admin_required
   @product_permission_required
   ```

2. **æ¬Šé™æª¢æŸ¥é‚è¼¯**
   - æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦ç™»å…¥
   - æª¢æŸ¥ç”¨æˆ¶è§’è‰²
   - æª¢æŸ¥ç”¢å“æ¬Šé™ï¼ˆhandler æˆ– adminï¼‰
   - æª¢æŸ¥æª”æ¡ˆæ¬Šé™ï¼ˆuploader æˆ– adminï¼‰

3. **å‰ç«¯æ¬Šé™é¡¯ç¤º**
   - æ ¹æ“š session['role'] é¡¯ç¤º/éš±è—æŒ‰éˆ•
   - JavaScript ä¸­æª¢æŸ¥æ¬Šé™

4. **API éŒ¯èª¤è™•ç†**
   - çµ±ä¸€çš„éŒ¯èª¤è¿”å›æ ¼å¼
   - 403 æ¬Šé™ä¸è¶³
   - 404 è³‡æºä¸å­˜åœ¨

**è«‹æä¾›å®Œæ•´çš„æ¬Šé™æ§åˆ¶ä»£ç¢¼ã€‚**
```

---

## æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### åŠŸèƒ½æ¸¬è©¦

#### ä¸»ç®¡åŠŸèƒ½
- [ ] ä¸»ç®¡å¯ä»¥å‰µå»ºè¨‚å–®
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è¨‚å–®
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¢å“
- [ ] ä¸»ç®¡å¯ä»¥æ–°å¢ç”¢å“åˆ°è¨‚å–®
- [ ] ä¸»ç®¡å¯ä»¥è½‰ç§»ç”¢å“è² è²¬äºº
- [ ] ä¸»ç®¡å¯ä»¥ä¸Šå‚³æª”æ¡ˆåˆ°ä»»ä½•ç”¢å“
- [ ] ä¸»ç®¡å¯ä»¥åˆªé™¤ä»»ä½•æª”æ¡ˆ
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¢å“çš„ç‹€æ…‹æ­·å²

#### ä¸»ç®¡å°ˆç”¨åŠŸèƒ½ï¼ˆç”¨æˆ¶ç®¡ç†ï¼‰
- [ ] ä¸»ç®¡å¯ä»¥å‰µå»ºæ–°ç”¨æˆ¶å¸³è™Ÿ
- [ ] ä¸»ç®¡å¯ä»¥ç·¨è¼¯ç”¨æˆ¶è³‡æ–™ï¼ˆå§“åã€è§’è‰²ï¼‰
- [ ] ä¸»ç®¡å¯ä»¥é‡è¨­ç”¨æˆ¶å¯†ç¢¼
- [ ] ä¸»ç®¡å¯ä»¥åœç”¨/å•Ÿç”¨ç”¨æˆ¶å¸³è™Ÿ
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶åˆ—è¡¨
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹æ¯å€‹ç”¨æˆ¶è² è²¬çš„ç”¢å“æ•¸é‡
- [ ] åœç”¨ç”¨æˆ¶æ™‚ï¼Œæç¤ºç”¢å“è½‰ç§»é¸é …
- [ ] æ‰¹é‡è½‰ç§»åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹ç”¢å“è½‰ç§»æ­·å²
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹ç”¨æˆ¶çš„è½‰ç§»è¨˜éŒ„
- [ ] ä¸»ç®¡å„€è¡¨æ¿æ­£ç¢ºé¡¯ç¤ºçµ±è¨ˆæ•¸æ“š
- [ ] ä¸»ç®¡å„€è¡¨æ¿é¡¯ç¤ºæ¥­å‹™å“¡å·¥ä½œé‡åˆ†å¸ƒ
- [ ] ä¸»ç®¡å„€è¡¨æ¿é¡¯ç¤ºæœ€è¿‘æ´»å‹•è¨˜éŒ„

#### æ¥­å‹™å“¡åŠŸèƒ½
- [ ] æ¥­å‹™å“¡ä¸èƒ½å‰µå»ºè¨‚å–®
- [ ] æ¥­å‹™å“¡åªèƒ½çœ‹åˆ°æœ‰è‡ªå·±è² è²¬ç”¢å“çš„è¨‚å–®
- [ ] æ¥­å‹™å“¡å¯ä»¥å‰µå»ºç”¢å“ï¼ˆè‡ªå·±è‡ªå‹•æˆç‚ºè² è²¬äººï¼‰
- [ ] æ¥­å‹™å“¡åªèƒ½çœ‹åˆ°è‡ªå·±è² è²¬çš„ç”¢å“
- [ ] æ¥­å‹™å“¡å¯ä»¥ä¸Šå‚³æª”æ¡ˆåˆ°è‡ªå·±è² è²¬çš„ç”¢å“
- [ ] æ¥­å‹™å“¡åªèƒ½åˆªé™¤è‡ªå·±ä¸Šå‚³çš„æª”æ¡ˆ
- [ ] æ¥­å‹™å“¡å¯ä»¥æ›´æ–°è‡ªå·±è² è²¬ç”¢å“çš„ç‹€æ…‹
- [ ] æ¥­å‹™å“¡çœ‹ä¸åˆ°ã€Œè½‰ç§»è² è²¬äººã€æŒ‰éˆ•

#### æª”æ¡ˆç®¡ç†
- [ ] æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼Œä¿å­˜åˆ°æ­£ç¢ºè·¯å¾‘
- [ ] æª”æ¡ˆè·¯å¾‘æ ¼å¼ï¼š/uploads/è¨‚å–®è™Ÿ/ç”¢å“ID/æª”å
- [ ] æª”æ¡ˆå¤§å°é™åˆ¶ç”Ÿæ•ˆï¼ˆ> 10MB æ‹’çµ•ï¼‰
- [ ] æª”æ¡ˆé¡å‹æª¢æŸ¥ç”Ÿæ•ˆ
- [ ] æª”æ¡ˆä¸‹è¼‰æ­£å¸¸
- [ ] æª”æ¡ˆåˆªé™¤ï¼ˆè»Ÿåˆªé™¤ï¼‰æ­£å¸¸
- [ ] å·²åˆªé™¤çš„æª”æ¡ˆä¸é¡¯ç¤ºåœ¨åˆ—è¡¨ä¸­
- [ ] æ‰¹é‡åˆªé™¤æª”æ¡ˆåŠŸèƒ½æ­£å¸¸
- [ ] æ‰¹é‡åˆªé™¤æ™‚æ¬Šé™æª¢æŸ¥æ­£ç¢º

#### ç”¨æˆ¶åŠŸèƒ½
- [ ] ç”¨æˆ¶å¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼
- [ ] ä¿®æ”¹å¯†ç¢¼æ™‚é©—è­‰åŸå¯†ç¢¼æ­£ç¢ºæ€§
- [ ] æ–°å¯†ç¢¼å¼·åº¦é©—è­‰ç”Ÿæ•ˆ

#### é€šçŸ¥ç³»çµ±
- [ ] å‰µå»ºè¨‚å–®æ™‚é€šçŸ¥æ‰€æœ‰æ¥­å‹™å“¡
- [ ] å‰µå»ºç”¢å“æ™‚é€šçŸ¥ä¸»ç®¡
- [ ] è½‰ç§»ç”¢å“æ™‚é€šçŸ¥æ–°èˆŠè² è²¬äºº
- [ ] è¨‚å–®é€¾æœŸæ™‚è‡ªå‹•ç™¼é€é€šçŸ¥
- [ ] é€šçŸ¥éˆ´éºé¡¯ç¤ºæœªè®€æ•¸é‡
- [ ] æ¨™è¨˜ç‚ºå·²è®€åŠŸèƒ½æ­£å¸¸
- [ ] é€šçŸ¥åˆ—è¡¨æŒ‰æ™‚é–“å€’åºæ’åˆ—

#### æ“ä½œæ—¥èªŒ
- [ ] å‰µå»ºè¨‚å–®æ“ä½œè¢«è¨˜éŒ„
- [ ] è½‰ç§»ç”¢å“æ“ä½œè¢«è¨˜éŒ„
- [ ] ä¿®æ”¹ç”¨æˆ¶æ“ä½œè¢«è¨˜éŒ„
- [ ] æ—¥èªŒæ­£ç¢ºè¨˜éŒ„æ“ä½œè€…å’Œæ™‚é–“
- [ ] ä¸»ç®¡å¯ä»¥æŸ¥çœ‹æ“ä½œæ—¥èªŒ
- [ ] æ¥­å‹™å“¡çœ‹ä¸åˆ°æ“ä½œæ—¥èªŒ

#### æ•¸æ“šåŒ¯å‡º
- [ ] å¯ä»¥åŒ¯å‡ºè¨‚å–®åˆ—è¡¨ç‚º Excel
- [ ] å¯ä»¥åŒ¯å‡ºç”¢å“åˆ—è¡¨ç‚º Excel
- [ ] å¯ä»¥ä¸‹è¼‰è¨‚å–®æ‰€æœ‰æª”æ¡ˆç‚º ZIP
- [ ] åŒ¯å‡ºçš„ Excel æ ¼å¼æ­£ç¢º
- [ ] ZIP æª”æ¡ˆçµæ§‹æ­£ç¢º

#### å®¢æˆ¶åç¨±å»ºè­°
- [ ] å‰µå»ºè¨‚å–®æ™‚é¡¯ç¤ºæ­·å²å®¢æˆ¶åˆ—è¡¨
- [ ] å¯ä»¥é¸æ“‡æ­·å²å®¢æˆ¶
- [ ] å¯ä»¥è¼¸å…¥æ–°å®¢æˆ¶åç¨±
- [ ] è‡ªå‹•å®ŒæˆåŠŸèƒ½æ­£å¸¸

#### åœ–ç‰‡é è¦½å¢å¼·
- [ ] åœ–ç‰‡å¯ä»¥æ”¾å¤§ç¸®å°
- [ ] åœ–ç‰‡å¯ä»¥æ—‹è½‰
- [ ] å…¨è¢å¹•æ¨¡å¼æ­£å¸¸å·¥ä½œ
- [ ] æ»‘é¼ æ»¾è¼ªç¸®æ”¾åŠŸèƒ½æ­£å¸¸
- [ ] æ”¾å¤§å¾Œå¯ä»¥æ‹–æ‹½ç§»å‹•
- [ ] PDF ç¬¬ä¸€é é è¦½æ­£å¸¸é¡¯ç¤º
- [ ] éµç›¤å¿«æ·éµåŠŸèƒ½æ­£å¸¸

#### ç”¢å“è½‰ç§»
- [ ] ä¸»ç®¡è½‰ç§»ç”¢å“å¾Œï¼ŒåŸè² è²¬äººçœ‹ä¸åˆ°è©²ç”¢å“
- [ ] æ–°è² è²¬äººå¯ä»¥çœ‹åˆ°è©²ç”¢å“
- [ ] æ–°è² è²¬äººå¯ä»¥çœ‹åˆ°èˆŠè² è²¬äººä¸Šå‚³çš„æª”æ¡ˆ
- [ ] æ–°è² è²¬äººä¸èƒ½åˆªé™¤èˆŠè² è²¬äººä¸Šå‚³çš„æª”æ¡ˆ
- [ ] è½‰ç§»è¨˜éŒ„æ­£ç¢ºè¨˜éŒ„åœ¨ product_handover_log

#### æ•¸æ“šå®Œæ•´æ€§
- [ ] è¨‚å–®è™Ÿä¸èƒ½é‡è¤‡
- [ ] ç”¢å“IDè‡ªå‹•ç”Ÿæˆä¸”ä¸é‡è¤‡
- [ ] è³‡æ–™å¤¾å‰µå»ºæˆåŠŸ
- [ ] ç‹€æ…‹æ­·å²è¨˜éŒ„æ­£ç¢º
- [ ] æ“ä½œäººè¨˜éŒ„æ­£ç¢ºï¼ˆcreated_by, handler, uploaded_byï¼‰

### æ¬Šé™æ¸¬è©¦
- [ ] æœªç™»å…¥ç”¨æˆ¶è¢«é‡å®šå‘åˆ°ç™»å…¥é 
- [ ] æ¥­å‹™å“¡è¨ªå•ä¸»ç®¡åŠŸèƒ½æ™‚è¿”å› 403
- [ ] æ¥­å‹™å“¡è¨ªå•å…¶ä»–äººç”¢å“æ™‚è¿”å› 403
- [ ] æ¥­å‹™å“¡åˆªé™¤å…¶ä»–äººæª”æ¡ˆæ™‚è¿”å› 403

### ç•Œé¢æ¸¬è©¦
- [ ] ä¸»ç®¡ç•Œé¢é¡¯ç¤ºæ‰€æœ‰åŠŸèƒ½æŒ‰éˆ•
- [ ] æ¥­å‹™å“¡ç•Œé¢éš±è—ä¸»ç®¡åŠŸèƒ½æŒ‰éˆ•
- [ ] æª”æ¡ˆåˆ—è¡¨æ­£ç¢ºé¡¯ç¤ºä¸Šå‚³è€…
- [ ] æª”æ¡ˆåˆ—è¡¨æ­£ç¢ºé¡¯ç¤ºã€Œå¯åˆªé™¤ã€æ¨™è¨˜
- [ ] ç”¢å“è½‰ç§» Modal æ­£å¸¸å·¥ä½œ
- [ ] æª”æ¡ˆä¸Šå‚³é€²åº¦æ¢æ­£å¸¸é¡¯ç¤º

---

## æ³¨æ„äº‹é …

### é‡è¦åŸå‰‡
1. **è¨‚å–®è™Ÿå›ºå®šä¸è®Š**ï¼šä¸»ç®¡å‰µå»ºå¾Œä¸å¯ä¿®æ”¹
2. **ç”¢å“IDæ°¸ä¸æ”¹è®Š**ï¼šç”¨æ–¼è³‡æ–™å¤¾å‘½å
3. **è³‡æ–™å¤¾ç”¨ç”¢å“ID**ï¼šä¸ç”¨è¨‚å–®è™Ÿï¼Œé¿å…æ··äº‚
4. **æ­·å²è¨˜éŒ„ä¸å¯è®Š**ï¼šå‰µå»ºè€…ã€ä¸Šå‚³è€…æ°¸é ä¿ç•™
5. **è»Ÿåˆªé™¤æª”æ¡ˆ**ï¼šä¸å¯¦éš›åˆªé™¤ï¼Œæ¨™è¨˜ is_deleted
6. **æ¬Šé™åš´æ ¼æª¢æŸ¥**ï¼šæ¯å€‹ API éƒ½è¦é©—è­‰æ¬Šé™

### è³‡æ–™å¤¾å‘½åè¦å‰‡
```
/uploads/
  /{è¨‚å–®è™Ÿ}/          â† ç”¨è¨‚å–®è™Ÿï¼ˆå› ç‚ºè¨‚å–®è™Ÿä¸æœƒæ”¹ï¼‰
    /{ç”¢å“ID}/        â† ç”¨ç”¢å“IDï¼ˆPR001, PR002...ï¼‰
      /æª”æ¡ˆ...
      
ç¯„ä¾‹ï¼š
/uploads/KC0001/PR001/drawing_v1.jpg
/uploads/KC0001/PR002/quotation.pdf
```

### æ•¸æ“šåº«ç´¢å¼•å»ºè­°
```sql
-- æé«˜æŸ¥è©¢æ•ˆèƒ½
CREATE INDEX idx_product_order ON products(order_number);
CREATE INDEX idx_product_handler ON products(handler_id);
CREATE INDEX idx_file_product ON files(product_id);
CREATE INDEX idx_file_uploader ON files(uploaded_by_id);
```

---

## ç¸½çµ

é€™ä»½æ–‡æª”æ¶µè“‹äº†ï¼š
1. âœ… å®Œæ•´çš„æ•¸æ“šçµæ§‹è¨­è¨ˆ
2. âœ… æ‰€æœ‰éœ€è¦å¯¦ç¾çš„ API ç«¯é»
3. âœ… å‰ç«¯ç•Œé¢æ”¹é€ æ–¹æ¡ˆ
4. âœ… æ¬Šé™æ§åˆ¶é‚è¼¯
5. âœ… åˆ†éšæ®µçš„ AI å¯¦ç¾æŒ‡å¼•
6. âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

**å»ºè­°å¯¦æ–½é †åºï¼š**
1. éšæ®µä¸€ï¼šæ•¸æ“šçµæ§‹ï¼ˆæœ€é‡è¦ï¼ŒåŸºç¤ï¼‰
2. éšæ®µäºŒï¼šç”¢å“ç®¡ç† API
3. éšæ®µä¸‰ï¼šæª”æ¡ˆä¸Šå‚³åŠŸèƒ½
4. éšæ®µä¸‰ä¹‹äºŒï¼šä¸»ç®¡å°ˆç”¨åŠŸèƒ½ï¼ˆç”¨æˆ¶ç®¡ç†ã€ç”¢å“è½‰ç§»ã€å„€è¡¨æ¿ï¼‰
5. éšæ®µå››ï¼šå³å´æŠ½å±œèˆ‡åœ–ç‰‡ç®¡ç† UI
6. éšæ®µå››ä¹‹ä¸‰ï¼šè¼”åŠ©åŠŸèƒ½ï¼ˆé€šçŸ¥ã€æ—¥èªŒã€åŒ¯å‡ºã€åœ–ç‰‡å¢å¼·ï¼‰
7. éšæ®µäº”ï¼šå‰ç«¯ç•Œé¢ï¼ˆå…¶ä»–é é¢ï¼‰
8. éšæ®µå…­ï¼šæ¬Šé™æ§åˆ¶èˆ‡æ¸¬è©¦

æ¯å€‹éšæ®µå®Œæˆå¾Œé€²è¡Œæ¸¬è©¦ï¼Œç¢ºèªç„¡èª¤å†é€²å…¥ä¸‹ä¸€éšæ®µã€‚

**é ä¼°å·¥ä½œé‡ï¼š**
- æ•¸æ“šçµæ§‹æ”¹é€ ï¼š1-2å¤©ï¼ˆåŒ…å«é€šçŸ¥è¡¨å’Œæ—¥èªŒè¡¨ï¼‰
- ç”¢å“ç®¡ç† APIï¼š2-3å¤©
- æª”æ¡ˆä¸Šå‚³åŠŸèƒ½ï¼š1-2å¤©
- ä¸»ç®¡å°ˆç”¨åŠŸèƒ½ï¼š2-3å¤©ï¼ˆç”¨æˆ¶ç®¡ç† + ç”¢å“è½‰ç§» + å„€è¡¨æ¿ï¼‰
- å³å´æŠ½å±œèˆ‡åœ–ç‰‡ç®¡ç† UIï¼š2-3å¤©
- è¼”åŠ©åŠŸèƒ½ï¼š3-4å¤©ï¼ˆé€šçŸ¥ç³»çµ± + æ—¥èªŒ + åŒ¯å‡º + åœ–ç‰‡å¢å¼· + æ‰¹é‡åˆªé™¤ï¼‰
- å‰ç«¯ç•Œé¢æ”¹é€ ï¼š2-3å¤©
- æ¬Šé™æ§åˆ¶èˆ‡æ¸¬è©¦ï¼š1-2å¤©
- **ç¸½è¨ˆï¼š14-22å¤©**ï¼ˆå–æ±ºæ–¼è¤‡é›œåº¦å’Œæ¸¬è©¦ï¼‰
