# å¸³è™Ÿæ¬Šé™ç®¡ç†å®Œæ•´èªªæ˜

## ğŸ“Œ æ¦‚è¿°

é€™ä»½æ–‡æª”è©³ç´°èªªæ˜ï¼š
1. âœ… å¸³è™Ÿè§’è‰²å®šç¾©
2. âœ… æ¯å€‹è§’è‰²èƒ½çœ‹åˆ°ä»€éº¼é é¢
3. âœ… æ¯å€‹è§’è‰²èƒ½åŸ·è¡Œä»€éº¼æ“ä½œ
4. âŒ è¨»å†ŠåŠŸèƒ½ï¼ˆæ˜¯å¦éœ€è¦ï¼Ÿï¼‰
5. âŒ å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½ï¼ˆæ˜¯å¦éœ€è¦ï¼Ÿï¼‰

---

## ğŸ­ ç³»çµ±è§’è‰²å®šç¾©

### **è§’è‰² 1ï¼šä¸»ç®¡ (admin)**

**å®šç¾©**ï¼š
- `session['role'] = 'admin'`
- å…¬å¸ç®¡ç†å±¤ã€ä¸»ç®¡
- æœ€é«˜æ¬Šé™

**èƒ½åšä»€éº¼**ï¼š
- âœ… æŸ¥çœ‹**æ‰€æœ‰**è¨‚å–®å’Œç”¢å“
- âœ… å‰µå»ºè¨‚å–®
- âœ… å‰µå»ºç”¢å“
- âœ… è½‰ç§»ç”¢å“çµ¦å…¶ä»–æ¥­å‹™å“¡
- âœ… åˆªé™¤è¨‚å–®/ç”¢å“
- âœ… ç®¡ç†ç”¨æˆ¶ï¼ˆå‰µå»ºæ¥­å‹™å“¡å¸³è™Ÿã€é‡è¨­å¯†ç¢¼ï¼‰
- âœ… æŸ¥çœ‹å„€è¡¨æ¿
- âœ… æŸ¥çœ‹æ“ä½œæ—¥èªŒ
- âœ… åŒ¯å‡ºæ•¸æ“šï¼ˆExcelã€ZIPï¼‰

**èƒ½è¨ªå•çš„é é¢**ï¼š
- âœ… `/tracking/` - é¦–é ï¼ˆè¨‚å–®åˆ—è¡¨ï¼‰
- âœ… `/tracking/orders/<order_number>` - è¨‚å–®è©³æƒ…
- âœ… `/tracking/products` - ç”¢å“åˆ—è¡¨ï¼ˆæ‰€æœ‰ç”¢å“ï¼‰
- âœ… `/tracking/admin/dashboard` - ä¸»ç®¡å„€è¡¨æ¿
- âœ… `/tracking/admin/users` - ç”¨æˆ¶ç®¡ç†
- âœ… `/tracking/reports` - å ±è¡¨é é¢

---

### **è§’è‰² 2ï¼šæ¥­å‹™å“¡ (staff)**

**å®šç¾©**ï¼š
- `session['role'] = 'staff'`
- è² è²¬è·Ÿé€²ç”¢å“çš„æ¥­å‹™äººå“¡
- ä¸­ç­‰æ¬Šé™

**èƒ½åšä»€éº¼**ï¼š
- âœ… æŸ¥çœ‹**è‡ªå·±è² è²¬**çš„ç”¢å“
- âœ… å‰µå»ºç”¢å“ï¼ˆåœ¨è¨‚å–®ä¸‹ï¼‰
- âœ… æ›´æ–°ç”¢å“ç‹€æ…‹
- âœ… ä¸Šå‚³æª”æ¡ˆåˆ°ç”¢å“
- âœ… åˆªé™¤è‡ªå·±ä¸Šå‚³çš„æª”æ¡ˆ
- âœ… ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼
- âŒ **ä¸èƒ½**å‰µå»ºè¨‚å–®
- âŒ **ä¸èƒ½**è½‰ç§»ç”¢å“
- âŒ **ä¸èƒ½**çœ‹å…¶ä»–äººçš„ç”¢å“
- âŒ **ä¸èƒ½**ç®¡ç†ç”¨æˆ¶

**èƒ½è¨ªå•çš„é é¢**ï¼š
- âœ… `/tracking/` - é¦–é ï¼ˆåªé¡¯ç¤ºè‡ªå·±è² è²¬çš„ç”¢å“ï¼‰
- âœ… `/tracking/orders/<order_number>` - è¨‚å–®è©³æƒ…ï¼ˆåªèƒ½çœ‹è‡ªå·±è² è²¬çš„ç”¢å“ï¼‰
- âœ… `/tracking/products` - ç”¢å“åˆ—è¡¨ï¼ˆåªé¡¯ç¤ºè‡ªå·±è² è²¬çš„ï¼‰
- âŒ `/tracking/admin/dashboard` - å„€è¡¨æ¿ï¼ˆç„¡æ¬Šè¨ªå•ï¼‰
- âŒ `/tracking/admin/users` - ç”¨æˆ¶ç®¡ç†ï¼ˆç„¡æ¬Šè¨ªå•ï¼‰

---

### **è§’è‰² 3ï¼šæŸ¥çœ‹è€… (viewer)** - å¯é¸

**å®šç¾©**ï¼š
- `session['role'] = 'viewer'`
- åªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½æ“ä½œ
- æœ€ä½æ¬Šé™

**èƒ½åšä»€éº¼**ï¼š
- âœ… æŸ¥çœ‹è¨‚å–®åˆ—è¡¨
- âœ… æŸ¥çœ‹è¨‚å–®è©³æƒ…
- âŒ **ä¸èƒ½**å‰µå»ºè¨‚å–®
- âŒ **ä¸èƒ½**å‰µå»ºç”¢å“
- âŒ **ä¸èƒ½**ä¸Šå‚³æª”æ¡ˆ
- âŒ **ä¸èƒ½**ä¿®æ”¹ä»»ä½•å…§å®¹

**å»ºè­°**ï¼š
- é€™å€‹è§’è‰²å¯èƒ½ä¸éœ€è¦ï¼ˆä½ çš„éœ€æ±‚ä¸­æ²’æåˆ°ï¼‰
- å¦‚æœéœ€è¦ï¼Œå¯ä»¥ç”¨ä¾†çµ¦å®¢æˆ¶æŸ¥çœ‹é€²åº¦

---

## ğŸ“Š é é¢è¨ªå•æ¬Šé™å°ç…§è¡¨

| é é¢ | ä¸»ç®¡ | æ¥­å‹™å“¡ | æŸ¥çœ‹è€… | è·¯ç”±è£é£¾å™¨ |
|------|------|--------|--------|-----------|
| ç™»å…¥é  | âœ… | âœ… | âœ… | ç„¡ |
| é¦–é ï¼ˆè¨‚å–®åˆ—è¡¨ï¼‰ | âœ… æ‰€æœ‰ | âœ… è‡ªå·±çš„ | âœ… æ‰€æœ‰ | `@login_required` |
| è¨‚å–®è©³æƒ… | âœ… æ‰€æœ‰ | âœ… è‡ªå·±çš„ | âœ… æ‰€æœ‰ | `@login_required` |
| ç”¢å“åˆ—è¡¨ | âœ… æ‰€æœ‰ | âœ… è‡ªå·±çš„ | âœ… æ‰€æœ‰ | `@login_required` |
| å‰µå»ºè¨‚å–® | âœ… | âŒ | âŒ | `@admin_required` |
| å‰µå»ºç”¢å“ | âœ… | âœ… | âŒ | `@login_required` |
| ä¸Šå‚³æª”æ¡ˆ | âœ… | âœ… | âŒ | `@login_required` |
| è½‰ç§»ç”¢å“ | âœ… | âŒ | âŒ | `@admin_required` |
| ç”¨æˆ¶ç®¡ç† | âœ… | âŒ | âŒ | `@admin_required` |
| ä¸»ç®¡å„€è¡¨æ¿ | âœ… | âŒ | âŒ | `@admin_required` |
| æ“ä½œæ—¥èªŒ | âœ… | âŒ | âŒ | `@admin_required` |
| æ•¸æ“šåŒ¯å‡º | âœ… | âŒ | âŒ | `@admin_required` |
| ä¿®æ”¹è‡ªå·±å¯†ç¢¼ | âœ… | âœ… | âœ… | `@login_required` |

---

## ğŸ”§ è·¯ç”±å’Œè£é£¾å™¨å¯¦ç¾

### **åœ¨ __init__.py ä¸­å·²æœ‰çš„è£é£¾å™¨**

ä½ çš„ä»£ç¢¼ä¸­å·²ç¶“æœ‰ï¼š

```python
# ç™»å…¥é©—è­‰è£é£¾å™¨
def login_required(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            return redirect(url_for('tracking_bp.login'))
        return f(*args, **kwargs)
    return decorated_function

# ä¸»ç®¡æ¬Šé™è£é£¾å™¨
def admin_required(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            return redirect(url_for('tracking_bp.login'))
        if session.get('role') != 'admin':
            return jsonify({'success': False, 'error': 'éœ€è¦ä¸»ç®¡æ¬Šé™'}), 403
        return f(*args, **kwargs)
    return decorated_function
```

### **é é¢è·¯ç”±ç¯„ä¾‹**

```python
# ===== æ‰€æœ‰äººéƒ½èƒ½è¨ªå•ï¼ˆéœ€ç™»å…¥ï¼‰=====
@tracking_bp.route('/')
@login_required
def index():
    """é¦–é  - æ‰€æœ‰äººèƒ½è¨ªå•ï¼Œä½†é¡¯ç¤ºçš„å…§å®¹ä¸åŒ"""
    return render_template('index.html')

@tracking_bp.route('/orders/<order_number>')
@login_required
def order_detail(order_number):
    """è¨‚å–®è©³æƒ… - æ‰€æœ‰äººèƒ½è¨ªå•ï¼Œä½†åªèƒ½çœ‹åˆ°è‡ªå·±è² è²¬çš„ç”¢å“"""
    return render_template('order_detail.html')

# ===== åªæœ‰ä¸»ç®¡èƒ½è¨ªå• =====
@tracking_bp.route('/admin/dashboard')
@admin_required
def admin_dashboard():
    """ä¸»ç®¡å„€è¡¨æ¿ - åªæœ‰ä¸»ç®¡èƒ½è¨ªå•"""
    return render_template('admin/dashboard.html')

@tracking_bp.route('/admin/users')
@admin_required
def admin_users():
    """ç”¨æˆ¶ç®¡ç† - åªæœ‰ä¸»ç®¡èƒ½è¨ªå•"""
    return render_template('admin/users.html')

# ===== æ¥­å‹™å“¡å’Œä¸»ç®¡éƒ½èƒ½è¨ªå• =====
@tracking_bp.route('/products')
@login_required
def products_list():
    """ç”¢å“åˆ—è¡¨ - ç™»å…¥å³å¯è¨ªå•ï¼Œä½†æ¥­å‹™å“¡åªçœ‹åˆ°è‡ªå·±çš„"""
    return render_template('products/list.html')
```

---

## ğŸš« è¨»å†ŠåŠŸèƒ½ - ä¸é–‹æ”¾ï¼

### **ç‚ºä»€éº¼ä¸éœ€è¦è¨»å†ŠåŠŸèƒ½ï¼Ÿ**

**åŸå› **ï¼š
1. âœ… é€™æ˜¯**å…§éƒ¨ç³»çµ±**ï¼Œä¸æ˜¯å…¬é–‹ç¶²ç«™
2. âœ… å¸³è™Ÿç”±**ä¸»ç®¡å‰µå»º**ï¼Œæ›´å®‰å…¨
3. âœ… å¯ä»¥æ§åˆ¶èª°èƒ½é€²å…¥ç³»çµ±
4. âœ… é¿å…æƒ¡æ„è¨»å†Š

### **å¦‚ä½•å‰µå»ºæ–°ç”¨æˆ¶ï¼Ÿ**

**æ–¹å¼ 1ï¼šä¸»ç®¡åœ¨å¾Œå°å‰µå»º**ï¼ˆæ¨è–¦ï¼‰

```
ä¸»ç®¡ç™»å…¥ â†’ ç”¨æˆ¶ç®¡ç† â†’ é»æ“Šã€Œ+ æ–°å¢ç”¨æˆ¶ã€ â†’ å¡«å¯«è³‡æ–™ â†’ å‰µå»º
```

æµç¨‹ï¼š
1. ä¸»ç®¡è¨ªå• `/tracking/admin/users`
2. é»æ“Šã€Œæ–°å¢ç”¨æˆ¶ã€æŒ‰éˆ•
3. å¡«å¯«ï¼š
   - ç”¨æˆ¶åï¼ˆç™»å…¥å¸³è™Ÿï¼‰
   - å¯†ç¢¼
   - å§“å
   - è§’è‰²ï¼ˆä¸»ç®¡/æ¥­å‹™å“¡ï¼‰
4. é»æ“Šã€Œå‰µå»ºã€
5. ç³»çµ±è‡ªå‹•ç™¼é€é€šçŸ¥çµ¦æ–°ç”¨æˆ¶ï¼ˆå¯é¸ï¼‰

**æ–¹å¼ 2ï¼šç›´æ¥åœ¨æ•¸æ“šåº«å‰µå»º**ï¼ˆä¸æ¨è–¦ï¼‰

```python
# åªåœ¨åˆå§‹åŒ–æ™‚ä½¿ç”¨
from werkzeug.security import generate_password_hash

conn = get_db()
cursor = conn.cursor()
cursor.execute('''
    INSERT INTO users (username, password_hash, display_name, real_name, role)
    VALUES (?, ?, ?, ?, ?)
''', ('admin', generate_password_hash('admin123'), 'ç³»çµ±ç®¡ç†å“¡', 'å¼µä¸‰', 'admin'))
conn.commit()
```

### **å¦‚æœçœŸçš„éœ€è¦è¨»å†ŠåŠŸèƒ½å‘¢ï¼Ÿ**

**å ´æ™¯**ï¼šçµ¦å®¢æˆ¶ä½¿ç”¨ï¼Œè®“ä»–å€‘è‡ªå·±è¨»å†ŠæŸ¥çœ‹è¨‚å–®é€²åº¦

**å¯¦ç¾**ï¼š

1. å‰µå»ºè·¯ç”±ï¼š
```python
@tracking_bp.route('/register', methods=['GET', 'POST'])
def register():
    """è¨»å†Šé é¢ï¼ˆå¯é¸ï¼Œçµ¦å®¢æˆ¶ç”¨ï¼‰"""
    if request.method == 'POST':
        # æª¢æŸ¥ç”¨æˆ¶åæ˜¯å¦å­˜åœ¨
        # å‰µå»ºå¸³è™Ÿï¼Œè§’è‰²å›ºå®šç‚º 'viewer'
        # ...
        return redirect(url_for('tracking_bp.login'))
    return render_template('register.html')
```

2. æ·»åŠ é©—è­‰ç¢¼ï¼ˆé˜²æ­¢æƒ¡æ„è¨»å†Šï¼‰
3. éœ€è¦ä¸»ç®¡å¯©æ ¸å¾Œæ‰èƒ½å•Ÿç”¨

**å»ºè­°**ï¼š**ä¸è¦åšè¨»å†ŠåŠŸèƒ½**ï¼Œé™¤éä½ æœ‰å…·é«”éœ€æ±‚ï¼

---

## ğŸ”‘ å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½

### **éœ€è¦å—ï¼Ÿ**

**å ´æ™¯ 1ï¼šå…§éƒ¨å“¡å·¥å¿˜è¨˜å¯†ç¢¼**
- âŒ **ä¸éœ€è¦**è‡ªåŠ©é‡è¨­å¯†ç¢¼
- âœ… ç›´æ¥æ‰¾ä¸»ç®¡é‡è¨­

**å ´æ™¯ 2ï¼šç³»çµ±å°å¤–é–‹æ”¾**
- âœ… éœ€è¦å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½
- éœ€è¦éƒµä»¶ç³»çµ±

### **æ¨è–¦æ–¹æ¡ˆï¼šä¸»ç®¡é‡è¨­å¯†ç¢¼**

**æµç¨‹**ï¼š
```
æ¥­å‹™å“¡å¿˜è¨˜å¯†ç¢¼ 
â†’ è¯ç¹«ä¸»ç®¡ 
â†’ ä¸»ç®¡ç™»å…¥ç³»çµ± 
â†’ ç”¨æˆ¶ç®¡ç† 
â†’ æ‰¾åˆ°è©²ç”¨æˆ¶ 
â†’ é»æ“Šã€Œé‡è¨­å¯†ç¢¼ã€
â†’ è¼¸å…¥æ–°å¯†ç¢¼
â†’ å‘Šè¨´æ¥­å‹™å“¡æ–°å¯†ç¢¼
```

**å·²ç¶“å¯¦ç¾åœ¨ M1**ï¼š

```python
@tracking_bp.route('/api/admin/users/<int:user_id>/reset-password', methods=['POST'])
@admin_required
def reset_user_password_api(user_id):
    """é‡è¨­ç”¨æˆ¶å¯†ç¢¼ï¼ˆä¸»ç®¡å°ˆç”¨ï¼‰"""
    data = request.get_json()
    new_password = data.get('new_password')
    
    # é‡è¨­å¯†ç¢¼
    # ...
```

### **å¦‚æœéœ€è¦ã€Œå¿˜è¨˜å¯†ç¢¼ã€è‡ªåŠ©åŠŸèƒ½**

**å¯¦ç¾æ­¥é©Ÿ**ï¼š

1. **æ·»åŠ éƒµä»¶æ¬„ä½**ï¼š
```sql
ALTER TABLE users ADD COLUMN email VARCHAR(200);
```

2. **å®‰è£éƒµä»¶åº«**ï¼š
```bash
pip install Flask-Mail
```

3. **å‰µå»ºè·¯ç”±**ï¼š
```python
@tracking_bp.route('/forgot-password', methods=['GET', 'POST'])
def forgot_password():
    """å¿˜è¨˜å¯†ç¢¼é é¢"""
    if request.method == 'POST':
        email = request.form.get('email')
        # 1. æª¢æŸ¥éƒµç®±æ˜¯å¦å­˜åœ¨
        # 2. ç”Ÿæˆé‡è¨­ token
        # 3. ç™¼é€éƒµä»¶
        # 4. é¡¯ç¤ºã€Œè«‹æŸ¥æ”¶éƒµä»¶ã€
    return render_template('forgot_password.html')

@tracking_bp.route('/reset-password/<token>', methods=['GET', 'POST'])
def reset_password(token):
    """é‡è¨­å¯†ç¢¼é é¢"""
    # 1. é©—è­‰ token
    # 2. è®“ç”¨æˆ¶è¼¸å…¥æ–°å¯†ç¢¼
    # 3. æ›´æ–°å¯†ç¢¼
    return render_template('reset_password.html')
```

4. **ç™»å…¥é æ·»åŠ é€£çµ**ï¼š
```html
<a href="{{ url_for('tracking_bp.forgot_password') }}">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
```

**å»ºè­°**ï¼š**ä¸è¦åšå¿˜è¨˜å¯†ç¢¼åŠŸèƒ½**ï¼Œå› ç‚ºï¼š
- âŒ éœ€è¦é…ç½®éƒµä»¶æœå‹™å™¨ï¼ˆè¤‡é›œï¼‰
- âŒ å®‰å…¨æ€§å•é¡Œ
- âœ… å…§éƒ¨ç³»çµ±ï¼Œç›´æ¥æ‰¾ä¸»ç®¡é‡è¨­æ›´å¿«

---

## ğŸ“‹ ç”¨æˆ¶å¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼

### **å·²ç¶“å¯¦ç¾åœ¨ M1**

```python
@tracking_bp.route('/api/user/change-password', methods=['POST'])
@login_required
def change_own_password_api():
    """ç”¨æˆ¶ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼"""
    data = request.get_json()
    
    old_password = data.get('old_password')
    new_password = data.get('new_password')
    confirm_password = data.get('confirm_password')
    
    # 1. é©—è­‰èˆŠå¯†ç¢¼
    # 2. é©—è­‰æ–°å¯†ç¢¼
    # 3. æ›´æ–°å¯†ç¢¼
```

### **å‰ç«¯ UI**

åœ¨ `base.html` çš„ç”¨æˆ¶èœå–®ä¸­ï¼š

```html
<div class="user-menu">
    <span>{{ session.display_name }}</span>
    <div class="dropdown">
        <a href="#" onclick="openChangePasswordModal()">ğŸ”‘ ä¿®æ”¹å¯†ç¢¼</a>
        
        {% if session.role == 'admin' %}
            <a href="/tracking/admin/users">ğŸ‘¥ ç”¨æˆ¶ç®¡ç†</a>
        {% endif %}
        
        <a href="{{ url_for('tracking_bp.logout') }}">ğŸšª ç™»å‡º</a>
    </div>
</div>

<!-- ä¿®æ”¹å¯†ç¢¼ Modal -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <h3>ä¿®æ”¹å¯†ç¢¼</h3>
        <form id="changePasswordForm">
            <input type="password" name="old_password" placeholder="åŸå¯†ç¢¼" required>
            <input type="password" name="new_password" placeholder="æ–°å¯†ç¢¼" required>
            <input type="password" name="confirm_password" placeholder="ç¢ºèªæ–°å¯†ç¢¼" required>
            <button type="submit">ç¢ºå®š</button>
        </form>
    </div>
</div>
```

---

## ğŸ¯ å®Œæ•´çš„é é¢å’Œæ¬Šé™çŸ©é™£

### **é é¢åˆ—è¡¨**

| # | é é¢è·¯å¾‘ | é é¢åç¨± | ä¸»ç®¡ | æ¥­å‹™å“¡ | æŸ¥çœ‹è€… | è£é£¾å™¨ |
|---|---------|---------|------|--------|--------|--------|
| 1 | `/tracking/login` | ç™»å…¥é  | âœ… | âœ… | âœ… | ç„¡ |
| 2 | `/tracking/` | é¦–é  | âœ… | âœ… | âœ… | `@login_required` |
| 3 | `/tracking/orders/<id>` | è¨‚å–®è©³æƒ… | âœ… | âœ… é™è‡ªå·± | âœ… | `@login_required` |
| 4 | `/tracking/products` | ç”¢å“åˆ—è¡¨ | âœ… | âœ… é™è‡ªå·± | âœ… | `@login_required` |
| 5 | `/tracking/reports` | å ±è¡¨é  | âœ… | âœ… é™è‡ªå·± | âœ… | `@login_required` |
| 6 | `/tracking/admin/dashboard` | å„€è¡¨æ¿ | âœ… | âŒ | âŒ | `@admin_required` |
| 7 | `/tracking/admin/users` | ç”¨æˆ¶ç®¡ç† | âœ… | âŒ | âŒ | `@admin_required` |

### **æ“ä½œåˆ—è¡¨**

| # | æ“ä½œ | API è·¯å¾‘ | ä¸»ç®¡ | æ¥­å‹™å“¡ | æŸ¥çœ‹è€… | è£é£¾å™¨ |
|---|------|---------|------|--------|--------|--------|
| 1 | å‰µå»ºè¨‚å–® | `POST /api/orders` | âœ… | âŒ | âŒ | `@admin_required` |
| 2 | å‰µå»ºç”¢å“ | `POST /api/orders/<id>/products` | âœ… | âœ… | âŒ | `@login_required` |
| 3 | æ›´æ–°ç”¢å“ç‹€æ…‹ | `PUT /api/products/<id>/status` | âœ… | âœ… é™è‡ªå·± | âŒ | `@login_required` |
| 4 | ä¸Šå‚³æª”æ¡ˆ | `POST /api/products/<id>/files` | âœ… | âœ… é™è‡ªå·± | âŒ | `@login_required` |
| 5 | åˆªé™¤æª”æ¡ˆ | `DELETE /api/files/<id>` | âœ… | âœ… é™è‡ªå·±ä¸Šå‚³çš„ | âŒ | `@login_required` |
| 6 | è½‰ç§»ç”¢å“ | `POST /api/admin/products/<id>/transfer` | âœ… | âŒ | âŒ | `@admin_required` |
| 7 | å‰µå»ºç”¨æˆ¶ | `POST /api/admin/users` | âœ… | âŒ | âŒ | `@admin_required` |
| 8 | é‡è¨­ä»–äººå¯†ç¢¼ | `POST /api/admin/users/<id>/reset-password` | âœ… | âŒ | âŒ | `@admin_required` |
| 9 | ä¿®æ”¹è‡ªå·±å¯†ç¢¼ | `POST /api/user/change-password` | âœ… | âœ… | âœ… | `@login_required` |
| 10 | åŒ¯å‡ºæ•¸æ“š | `GET /api/admin/export/orders` | âœ… | âŒ | âŒ | `@admin_required` |

---

## ğŸ” åˆå§‹ç®¡ç†å“¡å¸³è™Ÿ

### **å¦‚ä½•å‰µå»ºç¬¬ä¸€å€‹ä¸»ç®¡å¸³è™Ÿï¼Ÿ**

**æ–¹å¼ 1ï¼šåœ¨ M0 é·ç§»æ™‚è‡ªå‹•å‰µå»º**

åœ¨ `models.py` çš„ `migrate_database()` å‡½æ•¸ä¸­æ·»åŠ ï¼š

```python
def migrate_database():
    # ... å…¶ä»–é·ç§»ä»£ç¢¼ ...
    
    # æª¢æŸ¥æ˜¯å¦å·²æœ‰ç®¡ç†å“¡
    cursor.execute("SELECT COUNT(*) as count FROM users WHERE role = 'admin'")
    admin_count = cursor.fetchone()['count']
    
    if admin_count == 0:
        print("âš ï¸  ç³»çµ±ä¸­æ²’æœ‰ç®¡ç†å“¡ï¼Œå‰µå»ºé»˜èªç®¡ç†å“¡å¸³è™Ÿ...")
        
        from werkzeug.security import generate_password_hash
        
        cursor.execute('''
            INSERT INTO users (username, password_hash, display_name, real_name, role)
            VALUES (?, ?, ?, ?, ?)
        ''', (
            'admin',
            generate_password_hash('admin123'),  # âš ï¸ é¦–æ¬¡ç™»å…¥å¾Œè«‹ç«‹å³ä¿®æ”¹ï¼
            'ç³»çµ±ç®¡ç†å“¡',
            'ç³»çµ±ç®¡ç†å“¡',
            'admin'
        ))
        
        print("âœ… é»˜èªç®¡ç†å“¡å‰µå»ºæˆåŠŸï¼")
        print("   å¸³è™Ÿï¼šadmin")
        print("   å¯†ç¢¼ï¼šadmin123")
        print("   âš ï¸  è«‹ç«‹å³ç™»å…¥ä¸¦ä¿®æ”¹å¯†ç¢¼ï¼")
    
    conn.commit()
```

**æ–¹å¼ 2ï¼šæ‰‹å‹•åœ¨æ•¸æ“šåº«å‰µå»º**

```python
python
>>> from order_tracking.models import get_db
>>> from werkzeug.security import generate_password_hash
>>> 
>>> conn = get_db()
>>> cursor = conn.cursor()
>>> 
>>> cursor.execute('''
...     INSERT INTO users (username, password_hash, display_name, real_name, role)
...     VALUES (?, ?, ?, ?, ?)
... ''', ('admin', generate_password_hash('your_password'), 'å¼µä¸»ç®¡', 'å¼µä¸‰', 'admin'))
>>> 
>>> conn.commit()
>>> conn.close()
>>> print("ç®¡ç†å“¡å‰µå»ºæˆåŠŸï¼")
```

---

## âœ… ç¸½çµ

### **å·²ç¶“æœ‰çš„åŠŸèƒ½**ï¼š
- âœ… ç™»å…¥ç³»çµ±
- âœ… è§’è‰²æ¬Šé™ï¼ˆadmin / staff / viewerï¼‰
- âœ… ä¸»ç®¡å‰µå»ºç”¨æˆ¶
- âœ… ä¸»ç®¡é‡è¨­å¯†ç¢¼
- âœ… ç”¨æˆ¶ä¿®æ”¹è‡ªå·±å¯†ç¢¼
- âœ… åŸºæ–¼è§’è‰²çš„é é¢è¨ªå•æ§åˆ¶
- âœ… åŸºæ–¼è§’è‰²çš„ API æ¬Šé™æ§åˆ¶

### **ä¸éœ€è¦çš„åŠŸèƒ½**ï¼š
- âŒ è¨»å†ŠåŠŸèƒ½ï¼ˆå…§éƒ¨ç³»çµ±ï¼Œä¸»ç®¡å‰µå»ºå³å¯ï¼‰
- âŒ å¿˜è¨˜å¯†ç¢¼ï¼ˆç›´æ¥æ‰¾ä¸»ç®¡é‡è¨­ï¼‰

### **å»ºè­°çš„å·¥ä½œæµç¨‹**ï¼š

**1. ç³»çµ±åˆå§‹åŒ–**ï¼š
```
é‹è¡Œ migrate_database() â†’ è‡ªå‹•å‰µå»º admin å¸³è™Ÿ
```

**2. ä¸»ç®¡å‰µå»ºæ¥­å‹™å“¡**ï¼š
```
ä¸»ç®¡ç™»å…¥ â†’ ç”¨æˆ¶ç®¡ç† â†’ æ–°å¢ç”¨æˆ¶ â†’ å¡«å¯«è³‡æ–™ â†’ å‰µå»º
```

**3. æ¥­å‹™å“¡é¦–æ¬¡ç™»å…¥**ï¼š
```
ç”¨ä¸»ç®¡çµ¦çš„å¸³å¯†ç™»å…¥ â†’ ä¿®æ”¹å¯†ç¢¼
```

**4. å¿˜è¨˜å¯†ç¢¼**ï¼š
```
è¯ç¹«ä¸»ç®¡ â†’ ä¸»ç®¡é‡è¨­å¯†ç¢¼
```

---

## ğŸ¯ éœ€è¦è£œå……åˆ°å“ªå€‹ MDï¼Ÿ

å»ºè­°å‰µå»ºä¸€å€‹æ–°çš„ï¼š

**ã€ŒM0.5-å¸³è™Ÿåˆå§‹åŒ–.mdã€**

åŒ…å«ï¼š
1. å‰µå»ºåˆå§‹ç®¡ç†å“¡å¸³è™Ÿ
2. ç®¡ç†å“¡å¦‚ä½•å‰µå»ºæ¥­å‹™å“¡
3. æ¥­å‹™å“¡å¦‚ä½•ä¿®æ”¹å¯†ç¢¼
4. å¿˜è¨˜å¯†ç¢¼çš„è™•ç†æµç¨‹

---

**ä½ è¦ºå¾—é€™æ¨£çš„è¨­è¨ˆåˆç†å—ï¼Ÿé‚„æ˜¯ä½ éœ€è¦è¨»å†Šå’Œå¿˜è¨˜å¯†ç¢¼åŠŸèƒ½ï¼Ÿ** ğŸ¤”
