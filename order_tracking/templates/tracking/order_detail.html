{% extends "base.html" %}

{% block title %}è¨‚å–®è©³æƒ… - {{ order.order_number }}{% endblock %}

{% block content %}
<div class="detail-page">
    <div class="page-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>è¨‚å–®è©³æƒ… #{{ order.order_number }}</h1>
                <p class="page-subtitle">{{ order.customer_name }}</p>
            </div>
            {% if session.get('role') == 'admin' %}
            <a href="{{ url_for('tracking_bp.order_edit', order_number=order.order_number) }}" class="btn btn-primary">ç·¨è¼¯</a>
            {% endif %}
        </div>
    </div>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <div class="section">
        <h2>åŸºæœ¬ä¿¡æ¯</h2>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">è¨‚å–®è™Ÿ</div>
                <div class="info-value">{{ order.order_number }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">å®¢æˆ¶åç¨±</div>
                <div class="info-value">{{ order.customer_name }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">è¨‚å–®æ—¥æœŸ</div>
                <div class="info-value">{{ order.order_date }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">ç•¶å‰ç‹€æ…‹</div>
                <div class="info-value status-badge status-{{ order.current_status }}">
                    <span class="light-emoji">
                        {% if order.status_light == 'red' %}ğŸ”´
                        {% elif order.status_light == 'yellow' %}ğŸŸ¡
                        {% else %}ğŸŸ¢{% endif %}
                    </span>
                    {{ order.current_status }}
                </div>
            </div>
            <div class="info-item">
                <div class="info-label">ç­‰å¾…å¤©æ•¸</div>
                <div class="info-value">{{ order.status_days }} å¤©</div>
            </div>
            <div class="info-item">
                <div class="info-label">ç”Ÿç”¢é¡å‹</div>
                <div class="info-value">{{ order.production_type or '-' }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">é è¨ˆäº¤è²¨</div>
                <div class="info-value">{{ order.expected_delivery_date or '-' }}</div>
            </div>
        </div>
    </div>

    <!-- ç‹€æ…‹æ­·å² -->
    <div class="section">
        <h2>ç‹€æ…‹æ­·å²</h2>
        {% if history %}
        <div class="timeline">
            {% for item in history %}
            <div class="timeline-item">
                <div class="timeline-marker"></div>
                <div class="timeline-content">
                    <div class="timeline-header">
                        <span class="timeline-status">{{ item.to_status }}</span>
                        <span class="timeline-date">{{ item.action_date }}</span>
                    </div>
                    {% if item.notes %}
                    <div class="timeline-notes">{{ item.notes }}</div>
                    {% endif %}
                    {% if item.operator %}
                    <div class="timeline-operator">æ“ä½œäººï¼š{{ item.operator }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">æš«ç„¡æ­·å²è¨˜éŒ„</div>
        {% endif %}
    </div>

    <!-- å‚™è¨» -->
    <div class="section">
        <h2>å‚™è¨»</h2>
        {% if notes %}
        <div class="notes-list">
            {% for note in notes %}
            <div class="note-item">
                <div class="note-content">{{ note.content }}</div>
                <div class="note-meta">
                    <span>{{ note.created_by or 'ç³»çµ±' }}</span>
                    <span>{{ note.created_at }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">æš«ç„¡å‚™è¨»</div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.info-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.info-value {
    font-size: 1rem;
    font-weight: 500;
}

.timeline {
    position: relative;
    padding-left: 2rem;
}

.timeline-item {
    position: relative;
    padding-bottom: 2rem;
    border-left: 2px solid var(--border-color);
    padding-left: 2rem;
}

.timeline-item:last-child {
    border-left: none;
}

.timeline-marker {
    position: absolute;
    left: -6px;
    top: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--accent-blue);
    border: 2px solid var(--bg-secondary);
}

.timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.timeline-status {
    font-weight: 600;
    color: var(--text-primary);
}

.timeline-date {
    color: var(--text-muted);
    font-size: 0.85rem;
    font-family: 'JetBrains Mono', monospace;
}

.timeline-notes {
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.timeline-operator {
    color: var(--text-muted);
    font-size: 0.85rem;
}

.notes-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.note-item {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
}

.note-content {
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

.note-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--text-muted);
}
</style>
{% endblock %}

